@page "/"
@using System.Linq
@using System.Globalization
@inject NavigationManager navigate
@using Microsoft.AspNetCore.Components.Web
@using pruebas1.Entidades

<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<div class="agenda-container">
    <div class="top-bar-container">
        <div class="fecha-header">
            <button class="calendar-btn" @onclick="DiaAnterior"><i class="bi bi-arrow-left-circle"></i></button>
            <span class="fecha-texto">@FechaFormateada</span>
            <button class="calendar-btn" @onclick="DiaSiguiente"><i class="bi bi-arrow-right-circle"></i></button>

            <div class="calendar-wrapper">
                <button class="calendar-btn" @onclick="AbrirCalendario">📅</button>

                @if (MostrarModal)
                {
                    <div class="modal-popover" @onclick:stopPropagation="true">
                        <div class="calendar-header">
                            <button class="calendar-btn" @onclick="MesAnterior"><i class="bi bi-chevron-left"></i></button>
                            <strong>@MesActual.ToString("MMMM yyyy", new CultureInfo("es-ES"))</strong>
                            <button class="calendar-btn" @onclick="MesSiguiente"><i class="bi bi-chevron-right"></i></button>
                        </div>

                        <div class="calendar-grid">
                            @foreach (var dia in DiasSemana)
                            {
                                <div class="calendar-week-day"><strong>@dia</strong></div>
                            }
                            @foreach (var day in DiasDelCalendario)
                            {
                                <div class="calendar-day @(day.Month != MesActual.Month ? "calendar-other-month" : "") @(day.Date == DateTime.Now.Date ? "calendar-today" : "")"
                                     @onclick="() => SeleccionarFecha(day)">
                                    @day.Day
                                </div>
                            }
                        </div>

                        <div style="margin-top:10px; text-align:center;">
                            <button class="calendar-btn" @onclick="CerrarCalendario">✖ Cerrar</button>
                        </div>
                    </div>
                }
            </div>

        </div>
        <div class="modal-button-container"> <ReusableModal OnSave="AgregarTarea" /> </div>
    </div>

    <br />

    @if (FechaSeleccionada.DayOfWeek == DayOfWeek.Sunday)
    {
        <div class="col-12 text-center">
            <div class="alert alert-warning shadow-sm">
                Día no laboral – @FechaSeleccionada.ToString("dddd, dd MMMM yyyy", new CultureInfo("es-ES"))
            </div>
        </div>
    }
    else
    {
        @if (Categories.FirstOrDefault(c => c.Name.Trim() == "Tareas") is CategoryModel tareasCat)
        {
            <div class="card block-card @tareasCat.ColorClass">
                <div class="block-header" @onclick="() => ToggleCollapse(tareasCat)">
                    <div class="header-left">
                        <h3 class="categoria-titulo">@tareasCat.Icon @tareasCat.Name</h3>
                    </div>
                    <div class="header-right">
                        @if (AllCompleted(tareasCat))
                        {
                            <span class="badge completado">Completado ✓</span>
                        }
                        else
                        {
                            <span class="badge pendiente">@RemainingCount(tareasCat) pendiente(s)</span>
                        }
                        <button class="btn btn-floating" style="font-size:0.8rem; padding:0.2rem 0.5rem;">
                            @(tareasCat.IsCollapsed ? "▼" : "▲")
                        </button>
                    </div>
                </div>

                @if (!tareasCat.IsCollapsed)
                {
                    <div class="card-body block-body @(tareasCat.IsCollapsed ? "collapsed" : "")">
                        <ul class="subtask-list">
                            @foreach (var st in tareasCat.Subtasks)
                            {
                                <li class="subtask-item">
                                    <div class="subtask-label @(st.IsDone && tareasCat.Name != "Autoevaluación" ? "done" : "")">
                                        <input type="checkbox" checked="@st.IsDone" @onchange="(e) => ToggleSubtask(tareasCat, st)" />
                                        <span class="subtask-text">@st.Title</span>
                                        @if (st.IsDone)
                                        {
                                            <small class="done-text">Hecho</small>
                                        }
                                        @if (tareasCat.Name.Trim() == "Tareas")
                                        {
                                            <div class="subtask-actions">
                                                <button class="icon-btn edit" title="Modificar fecha" @onclick="() => OpenModificarModal(tareasCat, st)">
                                                    <i class="bi bi-calendar"></i>
                                                </button>
                                                <button class="icon-btn edit" title="Editar" @onclick="() => OpenEditModal(tareasCat, st)">
                                                    <i class="bi bi-pencil"></i>
                                                </button>
                                                <button class="icon-btn delete" title="Eliminar" @onclick="() => DeleteSubtask(tareasCat, st)">
                                                    <i class="bi bi-trash3"></i>
                                                </button>
                                            </div>
                                        }
                                    </div>
                                    @if (st.Subtasks.Any())
                                    {
                                        <div class="table-wrapper">
                                            <ul class="subtask-list">
                                                @foreach (var s2 in st.Subtasks)
                                                {
                                                    <li class="subtask-item">
                                                        <div class="subtask-label @(s2.IsDone ? "done" : "")">
                                                            <input type="checkbox" checked="@s2.IsDone" @onchange="(e) => ToggleInnerSubtask(tareasCat, st, s2)" />
                                                            <span class="subtask-text">@($"Objetivo de {s2.Title}")</span>
                                                            <div class="subtask-actions">
                                                                <button class="icon-btn edit" title="Modificar fecha" @onclick="() => OpenModificarModal(tareasCat, st)">
                                                                    <i class="bi bi-calendar"></i>
                                                                </button>
                                                                <button class="icon-btn edit" title="Editar" @onclick="() => OpenEditInnerModal(tareasCat, st, s2)">
                                                                    <i class="bi bi-pencil"></i>
                                                                </button>
                                                                <button class="icon-btn delete" title="Eliminar" @onclick="() => DeleteInnerSubtask(tareasCat, st, s2)">
                                                                    <i class="bi bi-trash3"></i>
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </li>
                                                }
                                            </ul>
                                        </div>
                                    }
                                </li>
                            }
                        </ul>
                    </div>
                }
            </div>
            <br />
        }

        @if (Categories.FirstOrDefault(c => c.Name.Trim() == "Órdenes de Trabajo") is CategoryModel otCat)
        {
            <div class="card block-card naranja-melocoton">
                <div class="block-header" @onclick="() => ToggleCollapse(otCat)">
                    <div class="header-left">
                        <h3 class="categoria-titulo">@otCat.Icon Órdenes de Trabajo</h3>
                    </div>
                    <div class="header-right">
                        <span class="badge pendiente">@((OrdenesParaMostrar ?? Enumerable.Empty<OrdenTrabajoModel>()).Count()) orden(es)</span>
                        <button class="btn btn-floating" style="font-size:0.8rem; padding:0.2rem 0.5rem;">
                            @(otCat.IsCollapsed ? "▼" : "▲")
                        </button>
                    </div>
                </div>

                @if (!otCat.IsCollapsed)
                {
                    <div class="card-body block-body">
                        <div class="ordenes-workboard">
                            @if (OrdenesParaMostrar != null && OrdenesParaMostrar.Any())
                            {
                                <div class="columns-container">

                                    <!-- 🔴 Columna 1: Vencidas -->
                                    <div class="column column-expired">
                                        @foreach (var ot in OrdenesParaMostrar.Where(o => o.Status == OrdenStatus.Vencida).OrderBy(o => o.FechaConclusion))
                                        {
                                            <div class="ot-card ot-expired">
                                                <div class="ot-left">
                                                    <div class="ot-number">@ot.Numero</div>
                                                    <div class="ot-date">@ot.FechaConclusion.ToString("dd/MM/yyyy")</div>
                                                </div>
                                                <div class="ot-middle">
                                                    <span class="badge badge-expired">Vencida</span>
                                                </div>
                                                <div class="ot-right">
                                                    <button class="icon-eye" title="Ver orden" @onclick="() => OpenOrderModal(ot)">
                                                        <i class="bi bi-eye-fill"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        }
                                    </div>

                                    <!-- 🟡 Columna 2: Próximas -->
                                    <div class="column column-soon">
                                        @foreach (var ot in OrdenesParaMostrar.Where(o => o.Status == OrdenStatus.Proxima).OrderBy(o => o.FechaConclusion))
                                        {
                                            <div class="ot-card ot-soon">
                                                <div class="ot-left">
                                                    <div class="ot-number">@ot.Numero</div>
                                                    <div class="ot-date">@ot.FechaConclusion.ToString("dd/MM/yyyy")</div>
                                                </div>
                                                <div class="ot-middle">
                                                    <span class="badge badge-soon">Próx.</span>
                                                </div>
                                                <div class="ot-right">
                                                    <button class="icon-eye" title="Ver orden" @onclick="() => OpenOrderModal(ot)">
                                                        <i class="bi bi-eye-fill"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        }
                                    </div>

                                    <!-- 🟢 Columna 3: Normales -->
                                    <div class="column column-normal">
                                        @foreach (var ot in OrdenesParaMostrar.Where(o => o.Status == OrdenStatus.Normal).OrderBy(o => o.FechaConclusion))
                                        {
                                            <div class="ot-card ot-normal">
                                                <div class="ot-left">
                                                    <div class="ot-number">@ot.Numero</div>
                                                    <div class="ot-date">@ot.FechaConclusion.ToString("dd/MM/yyyy")</div>
                                                </div>
                                                <div class="ot-middle">
                                                    <span class="badge badge-normal">Hoy</span>
                                                </div>
                                                <div class="ot-right">
                                                    <button class="icon-eye" title="Ver orden" @onclick="() => OpenOrderModal(ot)">
                                                        <i class="bi bi-eye-fill"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        }
                                    </div>

                                </div>
                            }
                            else
                            {
                                <div class="no-ordenes">No hay órdenes para mostrar</div>
                            }
                        </div>
                    </div>
                }
            </div>
            <br />
        }


        @foreach (var cat in Categories.Where(c => c.Name.Trim() != "Órdenes de Trabajo" && c.Name.Trim() != "Tareas"))
        {
            <div class="card block-card @cat.ColorClass">
                <div class="block-header" @onclick="() => ToggleCollapse(cat)">
                    <div class="header-left">
                        <h3 class="categoria-titulo">@cat.Icon @cat.Name</h3>
                    </div>
                    <div class="header-right">
                        @if (AllCompleted(cat))
                        {
                            <span class="badge completado">Completado ✓</span>
                        }
                        else
                        {
                            <span class="badge pendiente">@RemainingCount(cat) pendiente(s)</span>
                        }
                        <button class="btn btn-floating" style="font-size:0.8rem; padding:0.2rem 0.5rem;">
                            @(cat.IsCollapsed ? "▼" : "▲")
                        </button>
                    </div>
                </div>

                @if (!cat.IsCollapsed)
                {
                    <div class="card-body block-body @(cat.IsCollapsed ? "collapsed" : "")">
                        <ul class="subtask-list">
                            @foreach (var st in cat.Subtasks)
                            {
                                <li class="subtask-item">
                                    <div class="subtask-label @(st.IsDone && cat.Name != "Autoevaluación" ? "done" : "")">
                                        @if (cat.Name.Trim() != "Órdenes de Trabajo")
                                        {
                                            <input type="checkbox" checked="@st.IsDone" @onchange="(e) => ToggleSubtask(cat, st)" />
                                        }
                                        <span class="subtask-text">@st.Title</span>
                                        @if (st.IsDone)
                                        {
                                            <small class="done-text">Hecho</small>
                                        }
                                        @if (cat.Name.Trim() == "Tareas")
                                        {
                                            <div class="subtask-actions">
                                                <button class="icon-btn edit" title="Modificar fecha" @onclick="() => OpenModificarModal(cat, st)">
                                                    <i class="bi bi-calendar"></i>
                                                </button>
                                                <button class="icon-btn edit" title="Editar" @onclick="() => OpenEditModal(cat, st)">
                                                    <i class="bi bi-pencil"></i>
                                                </button>
                                                <button class="icon-btn delete" title="Eliminar" @onclick="() => DeleteSubtask(cat, st)">
                                                    <i class="bi bi-trash3"></i>
                                                </button>
                                            </div>
                                        }
                                    </div>

                                    @if ((cat.Name.Trim() == "Tareas" || cat.Name.Trim() == "Servicio a Cliente") && st.Subtasks.Any())
                                    {
                                        <div class="table-wrapper">
                                            @if (cat.Name.Trim() == "Servicio a Cliente")
                                            {
                                                <table class="subtask-table">
                                                    <thead>
                                                        <tr>
                                                            <th>Actividad</th>
                                                            <th>Hecho</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        @foreach (var s2 in st.Subtasks)
                                                        {
                                                            <tr>
                                                                <td>@s2.Title</td>
                                                                <td>
                                                                    <input type="checkbox" checked="@s2.IsDone" @onchange="(e) => ToggleInnerSubtask(cat, st, s2)" />
                                                                </td>
                                                            </tr>
                                                        }
                                                    </tbody>
                                                </table>
                                            }
                                            else
                                            {
                                                <ul class="subtask-list">
                                                    @foreach (var s2 in st.Subtasks)
                                                    {
                                                        <li class="subtask-item">
                                                            <div class="subtask-label @(s2.IsDone ? "done" : "")">
                                                                <input type="checkbox" checked="@s2.IsDone" @onchange="(e) => ToggleInnerSubtask(cat, st, s2)" />
                                                                <span class="subtask-text">@($"Objetivo de {s2.Title}")</span>
                                                                <div class="subtask-actions">
                                                                    <button class="icon-btn edit" title="Modificar fecha" @onclick="() => OpenModificarModal(cat, st)">
                                                                        <i class="bi bi-calendar"></i>
                                                                    </button>
                                                                    <button class="icon-btn edit" title="Editar" @onclick="() => OpenEditInnerModal(cat, st, s2)">
                                                                        <i class="bi bi-pencil"></i>
                                                                    </button>
                                                                    <button class="icon-btn delete" title="Eliminar" @onclick="() => DeleteInnerSubtask(cat, st, s2)">
                                                                        <i class="bi bi-trash3"></i>
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        </li>
                                                    }
                                                </ul>
                                            }
                                        </div>
                                    }
                                </li>
                            }
                        </ul>
                    </div>
                }
            </div>
            <br />
        }
    }
</div>



<!-- MODAL DE VISUALIZACIÓN DE ORDEN (EXTRA GRANDE) -->
@if (ShowOrderModal && SelectedOrden != null)
{
    <div class="modal-container visible" @onclick="CloseOrderModal">
        <div class="modal-content" @onclick:stopPropagation="true" style="max-width:1200px; width:95%; height:92vh;">
            <div class="modal-header" style="background:#2b2b3a; color:#fff;">
                <h2 class="modal-title">Orden - @SelectedOrden.Numero</h2>
                <span class="close-button" @onclick="CloseOrderModal">&times;</span>
            </div>

            <div class="modal-body-wrapper">
                <div class="form-section-wrapper">
                    <div class="form-section">
                        <div>
                            <label class="section-label">Número de orden</label>
                            <div>@SelectedOrden.Numero</div>
                        </div>

                        <div>
                            <label class="section-label">Fecha de solicitud</label>
                            <div>@(SelectedOrden.FechaSolicitud?.ToString("dd/MM/yyyy") ?? "-")</div>
                        </div>

                        <div>
                            <label class="section-label">Autor</label>
                            <div>@(SelectedOrden.Autor ?? "-")</div>
                        </div>

                        <div>
                            <label class="section-label">Nombre / Razón social</label>
                            <div>@(SelectedOrden.Cliente ?? "-")</div>
                        </div>

                        <div class="form-group-span-2">
                            <label class="section-label">Objetivo</label>
                            <div>@(SelectedOrden.Objetivo ?? "-")</div>
                        </div>

                        <div class="form-group-span-2">
                            <label class="section-label">Objetivos de otros</label>
                            <div>@(SelectedOrden.ObjetivosOtros ?? "-")</div>
                        </div>

                        <div>
                            <label class="section-label">Fecha programada de conclusión</label>
                            <div>@(SelectedOrden.FechaConclusion.ToString("dd/MM/yyyy"))</div>
                        </div>
                    </div>

                    <div style="margin-top:18px;" class="form-group-span-2">
                        <label class="section-label">Tareas</label>

                        <!-- Tabla minimalista estilo A (sin líneas) -->
                        <div class="tasks-table-minimal">
                            <div class="tasks-row tasks-header">
                                <div class="col-name">Nombre de la tarea</div>
                                <div class="col-desc">Descripción</div>
                                <div class="col-adv">Avance</div>
                            </div>

                            @foreach (var t in SelectedOrden?.Subtasks ?? Enumerable.Empty<TareaOrdenModel>())
                            {
                                <div class="tasks-row">
                                    <div class="col-name">@t.Title</div>
                                    <div class="col-desc">@(!string.IsNullOrEmpty(t.Description) ? t.Description : "-")</div>
                                    <div class="col-adv">@($"{t.ProgressPercent}%")</div>
                                </div>
                            }
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn small" @onclick="CloseOrderModal">Cerrar</button>
            </div>
        </div>
    </div>
}


<!-- MODAL DE VISUALIZACIÓN DE ORDEN (EXTRA GRANDE) -->
@if (ShowModificarFechaModal)
{
    <div class="modal-overlay" @onclick="CerrarModificarModal">
        <div class="modal-card" @onclick:stopPropagation="true">
            <h2 class="modal-title">
                <i class="bi bi-calendar-check"></i> Modificar Fecha
            </h2>

            @if (MostrarAlerta)
            {
                <div class="alerta @TipoAlerta">
                    @MensajeAlerta
                </div>
            }

            <div class="modal-body">
                <div class="form-group">
                    <label>📅 Fecha actual</label>
                    <input type="text" class="form-control" value="@FechaActual.ToString("dd/MM/yyyy")" readonly />
                </div>

                <div class="form-group">
                    <label>🗓️ Nueva fecha</label>
                    <input type="date" class="form-control" @bind="NuevaFecha" />
                </div>

                <div class="form-group">
                    <label>📝 Motivo del cambio <span style="color:red;">*</span></label>
                    <textarea class="form-control" rows="3" placeholder="Escribe el motivo del cambio..." @bind="Motivo"></textarea>
                </div>

                @if (HistorialCambios.Any())
                {
                    <div class="historial">
                        <h4>📜 Historial de cambios</h4>
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>Fecha anterior</th>
                                    <th>Nueva fecha</th>
                                    <th>Motivo</th>
                                    <th>Fecha de modificación</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var h in HistorialCambios.OrderByDescending(x => x.FechaModificacion))
                                {
                                    <tr>
                                        <td>@h.FechaAnterior.ToString("dd/MM/yyyy")</td>
                                        <td>@h.FechaNueva.ToString("dd/MM/yyyy")</td>
                                        <td>@h.Motivo</td>
                                        <td>@h.FechaModificacion.ToString("dd/MM/yyyy HH:mm")</td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                }
            </div>

            <div class="modal-footer">
                <button class="btn-guardar" @onclick="GuardarCambioFecha">
                    <i class="bi bi-save"></i> Guardar
                </button>
                <button class="btn-cancelar" @onclick="CerrarModificarModal">
                    <i class="bi bi-x-circle"></i> Cancelar
                </button>
            </div>
        </div>
    </div>
}


@code {
    // ---- FECHAS Y CALENDARIO ----
    private DateTime FechaSeleccionada { get; set; } = DateTime.Now.Date;
    private DateTime MesActual { get; set; } = DateTime.Now.Date;
    private bool MostrarModal { get; set; } = false;
    private string[] DiasSemana = { "Lun", "Mar", "Mié", "Jue", "Vie", "Sáb", "Dom" };
    private IEnumerable<DateTime> DiasDelCalendario { get; set; } = Enumerable.Empty<DateTime>();
    private string FechaFormateada => FechaSeleccionada.ToString("dddd, dd MMMM yyyy", new CultureInfo("es-ES"));

    // ---- MODELOS PARA EL BLOQUE DE ÓRDENES (D1) ----
    public class TareaOrdenModel
    {
        public string Title { get; set; }
        public string Description { get; set; }
        public int ProgressPercent { get; set; } = 0;
    }

    public class OrdenTrabajoModel
    {
        public string Id { get; set; } = Guid.NewGuid().ToString();
        public string Numero { get; set; }
        public DateTime FechaConclusion { get; set; } = DateTime.Today;
        public DateTime? FechaSolicitud { get; set; }
        public string Autor { get; set; }
        public string Cliente { get; set; }
        public string Objetivo { get; set; }
        public string ObjetivosOtros { get; set; }
        public List<TareaOrdenModel> Subtasks { get; set; } = new();
        public OrdenStatus Status { get; set; } = OrdenStatus.Normal;
    }
    //MODIFICARINICIO
    private bool ShowModificarFechaModal = false;
    private DateTime FechaActual { get; set; } = DateTime.Now;
    private DateTime NuevaFecha { get; set; } = DateTime.Now;
    private string Motivo { get; set; } = string.Empty;

    private List<HistorialFechaCambio> HistorialCambios { get; set; } = new();

    // alertas
    private bool MostrarAlerta = false;
    private string MensajeAlerta = string.Empty;
    private string TipoAlerta = "exito"; // "exito" o "error"

    private void OpenModificarModal(CategoryModel cat, SubtaskModel st)
    {
        FechaActual = st?.FechaConclusion != default ? st.FechaConclusion : DateTime.Now;
        NuevaFecha = FechaActual;
        Motivo = string.Empty;

        // si la subtarea tiene historial
        var hist = GetPropertyValue(st, "HistorialFechas") as List<HistorialFechaCambio>;
        HistorialCambios = hist ?? new List<HistorialFechaCambio>();

        MostrarAlerta = false;
        ShowModificarFechaModal = true;
    }

    private void GuardarCambioFecha()
    {
        if (string.IsNullOrWhiteSpace(Motivo))
        {
            MostrarAlerta = true;
            TipoAlerta = "error";
            MensajeAlerta = "El motivo del cambio es obligatorio.";
            return;
        }

        HistorialCambios.Add(new HistorialFechaCambio
        {
            FechaAnterior = FechaActual,
            FechaNueva = NuevaFecha,
            Motivo = Motivo,
            FechaModificacion = DateTime.Now
        });

        FechaActual = NuevaFecha;

        MostrarAlerta = true;
        TipoAlerta = "exito";
        MensajeAlerta = "¡Fecha modificada correctamente!";

        // puedes actualizar el objeto subtarea real aquí
        // st.FechaConclusion = NuevaFecha;
        // st.HistorialFechas = HistorialCambios;

        StateHasChanged();
    }

    private void CerrarModificarModal()
    {
        ShowModificarFechaModal = false;
    }

    private object? GetPropertyValue(object? obj, string propName)
    {
        if (obj == null) return null;
        try
        {
            var prop = obj.GetType().GetProperty(propName);
            if (prop != null) return prop.GetValue(obj);
        }
        catch { }
        return null;
    }

    public class HistorialFechaCambio
    {
        public DateTime FechaAnterior { get; set; }
        public DateTime FechaNueva { get; set; }
        public string Motivo { get; set; } = string.Empty;
        public DateTime FechaModificacion { get; set; } = DateTime.Now;
    }
    //cerrar
    void ToggleCollapse(CategoryModel cat)
    {
        cat.IsCollapsed = !cat.IsCollapsed;
    }

    // ---- MODELOS QUE YA TENÍAS (mantengo para compatibilidad) ----
    class SubtaskModel
    {
        public string Id { get; set; } = Guid.NewGuid().ToString();
        public string Title { get; set; }
        public bool IsDone { get; set; }
        public List<SubtaskModel> Subtasks { get; set; } = new();

        // Campos opcionales (si se usaran)
        public DateTime FechaConclusion { get; set; } = DateTime.Now.Date;
        public DateTime? FechaSolicitud { get; set; } = null;
        public string Autor { get; set; } = null;
        public string Cliente { get; set; } = null;
        public string Objetivo { get; set; } = null;
        public string ObjetivosOtros { get; set; } = null;
        public string Description { get; set; } = null;
        public int ProgressPercent { get; set; } = 0;
    }

    class CategoryModel
    {
        public string Name { get; set; }
        public List<SubtaskModel> Subtasks { get; set; } = new();
        public string ColorClass { get; set; } = "pastel-blue";
        public bool IsCollapsed { get; set; } = false;
        public string Icon { get; set; }
    }

    // ---- DATOS / INICIALIZACIÓN ----
    private List<CategoryModel> MasterCategories = new();
    private List<CategoryModel> Categories { get; set; } = new();

    // Lista de órdenes (separada y limpia)
    private List<OrdenTrabajoModel> OrdenesParaMostrar = new();

    protected override void OnInitialized()
    {
        InitializeMasterCategories();
        CargarTareasPorFecha();
        GenerarDiasCalendario();
        PrepararOrdenesVisuales();
    }

    string GetIcon(string title) => title switch
    {
        "Órdenes de Trabajo" => "🧾",
        "Tareas " => "🗂️",
        "Autoevalu00ación" => "⭐",
        "Servicio a Cliente" => "🏢",
        _ => "📋"
    };

    private void InitializeMasterCategories()
    {
        MasterCategories = new List<CategoryModel>
        {
            new CategoryModel { Name = "Tareas",ColorClass= "rosa-administrativa", Subtasks = new List<SubtaskModel>
                {
                    new SubtaskModel{ Title = "Me aseguré de que el área y la estación de insumos de TI esté limpia, ordenada y funcional.", Subtasks = new List<SubtaskModel>{ new SubtaskModel{ Title="Detalle 1"}, new SubtaskModel{ Title="Detalle 2" } } },
                    new SubtaskModel{ Title = "Di seguimiento en tiempo y forma al control de suscripciones de las que es responsable TI." },
                    new SubtaskModel{ Title = "Di seguimiento a la recepción de facturas de acuerdo con las solicitudes de pago y las entregue a Administración." },
                    new SubtaskModel{ Title = "Programé las citas inteligentemente y comunique al área y/o responsable del trabajo. " },
                }
            },
            new CategoryModel {
                Name = "Órdenes de Trabajo",
                ColorClass= "naranja-melocoton",
                Subtasks = new List<SubtaskModel>() // no la usamos como fuente principal
            },
            new CategoryModel { Name = "Autoevaluación",ColorClass= "azul-lavanda", Subtasks = new List<SubtaskModel>
                {
                    new SubtaskModel{ Title = "Me aseguré de que el área y la estación de insumos de TI esté limpia, ordenada y funcional." },
                    new SubtaskModel{ Title = "Di seguimiento en tiempo y forma al control de suscripciones de las que es responsable TI." },
                    new SubtaskModel{ Title = "Elaboré y compartí al área de Administración las solicitudes de pago del activo fijo de las que es responsable TI." }
                }
            },
              new CategoryModel { Name = "Servicio a Cliente", ColorClass= "azul-morado", Subtasks = new List<SubtaskModel>
                {
                   new SubtaskModel{ Title = "1658 Casas y desarrollos VITA SAPI de CV", Subtasks = new List<SubtaskModel>{ new SubtaskModel{ Title="Acordar con Lic.Gerardo cuando dara el informe"}, new SubtaskModel{ Title="Solicitar a TI descargar de CFDIS" } } },
                   new SubtaskModel{ Title = "1235 Construcciones y desarrollo nelsan SA de CV", Subtasks = new List<SubtaskModel>{ new SubtaskModel{ Title="Asegurar la recepción de documentos enviados por el Lic.Gerardo"}, new SubtaskModel{ Title="Visita a empresa(para revisar póliza,dudas del mes con Gerardo o Paola)" } } }
                }
            },
        };

        foreach (var category in MasterCategories)
        {
            category.Icon = GetIcon(category.Name);
        }
    }

    private void CargarTareasPorFecha()
    {
        Categories = MasterCategories.Select(c => new CategoryModel
        {
            Name = c.Name,
            ColorClass = c.ColorClass,
            Icon = c.Icon,
            Subtasks = c.Subtasks.Select(st => new SubtaskModel
            {
                Id = Guid.NewGuid().ToString(),
                Title = st.Title,
                IsDone = st.IsDone,
                Subtasks = st.Subtasks?.Select(s => new SubtaskModel { Title = s.Title, Description = s.Description, ProgressPercent = s.ProgressPercent }).ToList() ?? new List<SubtaskModel>(),
                FechaConclusion = st.FechaConclusion,
                FechaSolicitud = st.FechaSolicitud,
                Autor = st.Autor,
                Cliente = st.Cliente,
                Objetivo = st.Objetivo,
                ObjetivosOtros = st.ObjetivosOtros
            }).ToList()
        }).ToList();

        // Recalcula la lista de órdenes (si las traes desde backend deberías poblarla aquí)
        PrepararOrdenesVisuales();
    }

    private void PrepararOrdenesVisuales()
    {
        // Si tienes backend sustituye este bloque por la carga real.
        // Aquí creamos ejemplos para que lo veas en funcionamiento
        OrdenesParaMostrar = new List<OrdenTrabajoModel>
        {
            new OrdenTrabajoModel {
                Numero = "ORD-13537",
                FechaSolicitud = new DateTime(2025,8,27),
                Autor = "Nadia Vainey Ramirez Carmona",
                Cliente = "Grupo Mendez Asesores de Negocios SC",
                Objetivo = "799 trabajos especiales de tecnologías de la información",
                ObjetivosOtros = "equis",
                FechaConclusion = new DateTime(2025,9,17),
                Subtasks = new List<TareaOrdenModel> {
                    new TareaOrdenModel { Title = "Entrega del formato de control de inducciones", Description = "Al recibir esta inducción estuvo bien", ProgressPercent = 100 }
                }
            },
            new OrdenTrabajoModel {
                Numero = "ORD-13683",
                FechaSolicitud = new DateTime(2025,10,1),
                Autor = "Laura Gómez",
                Cliente = "Empresa Demo",
                Objetivo = "Instalación de red",
                FechaConclusion = DateTime.Today.AddDays(20),
                Subtasks = new List<TareaOrdenModel> {
                    new TareaOrdenModel { Title = "Instalación de switches", Description = "Programado", ProgressPercent = 20 }
                }
            },
            new OrdenTrabajoModel {
                Numero = "ORD-13296",
                FechaSolicitud = DateTime.Today.AddDays(2),
                Autor = "Miguel Ruiz",
                Cliente = "Comercial Central",
                Objetivo = "Actualización de software",
                FechaConclusion = DateTime.Today.AddDays(4),
                Subtasks = new List<TareaOrdenModel> {
                    new TareaOrdenModel { Title = "Pruebas en ambiente", Description = "En progreso", ProgressPercent = 50 }
                }
            },
            new OrdenTrabajoModel {
                Numero = "ORD-13503",
                FechaSolicitud = new DateTime(2025,9,5),
                Autor = "Carlos Pérez",
                Cliente = "Cliente Ejemplo SA",
                Objetivo = "Mantenimiento de servidores",
                FechaConclusion = DateTime.Today.AddDays(-3),
                Subtasks = new List<TareaOrdenModel> {
                    new TareaOrdenModel { Title = "Revisión de backup", Description = "Backup incompleto", ProgressPercent = 70 }
                }
            },
            // extras para mostrar llenado
            new OrdenTrabajoModel {
                Numero = "ORD-14020",
                FechaConclusion = DateTime.Today.AddDays(40),
                FechaSolicitud = DateTime.Today.AddDays(-10),
                Autor = "Sofia Martínez",
                Cliente = "Empresa Alfa",
                Objetivo = "Nueva instalación",
                Subtasks = new List<TareaOrdenModel>{ new TareaOrdenModel{ Title="Preparar infraestructura", Description="Pendiente", ProgressPercent=0 } }
            },
            new OrdenTrabajoModel {
                Numero = "ORD-12100",
                FechaConclusion = DateTime.Today.AddDays(-10),
                FechaSolicitud = DateTime.Today.AddDays(-30),
                Autor = "Luis Torres",
                Cliente = "Cliente Beta",
                Objetivo = "Soporte técnico",
                Subtasks = new List<TareaOrdenModel>{ new TareaOrdenModel{ Title="Atender incidencia", Description="Retrasado", ProgressPercent=40 } }
            }
        };

        // Calcula estados
        var hoy = DateTime.Today;
        foreach (var o in OrdenesParaMostrar)
        {
            if (o.FechaConclusion.Date < hoy) o.Status = OrdenStatus.Vencida;
            else if ((o.FechaConclusion.Date - hoy).TotalDays <= 5) o.Status = OrdenStatus.Proxima;
            else o.Status = OrdenStatus.Normal;
        }
    }

    // ---- Modal orden ----
    private bool ShowOrderModal { get; set; } = false;
    private OrdenTrabajoModel? SelectedOrden { get; set; }

    private void OpenOrderModal(OrdenTrabajoModel orden)
    {
        SelectedOrden = orden;
        ShowOrderModal = true;
        StateHasChanged();
    }

    public enum OrdenStatus
    {
        Normal,
        Proxima,
        Vencida
    }

    private void CloseOrderModal()
    {
        SelectedOrden = null;
        ShowOrderModal = false;
    }

    // ---- Calendario helpers ----
    private void DiaAnterior() { FechaSeleccionada = FechaSeleccionada.AddDays(-1); CargarTareasPorFecha(); GenerarDiasCalendario(); }
    private void DiaSiguiente() { FechaSeleccionada = FechaSeleccionada.AddDays(1); CargarTareasPorFecha(); GenerarDiasCalendario(); }
    private void AbrirCalendario() => MostrarModal = true;
    private void CerrarCalendario() => MostrarModal = false;
    private void MesAnterior() { MesActual = MesActual.AddMonths(-1); GenerarDiasCalendario(); }
    private void MesSiguiente() { MesActual = MesActual.AddMonths(1); GenerarDiasCalendario(); }
    private void SeleccionarFecha(DateTime nuevaFecha) { FechaSeleccionada = nuevaFecha; CerrarCalendario(); CargarTareasPorFecha(); }
    private void GenerarDiasCalendario()
    {
        var primerDiaDelMes = new DateTime(MesActual.Year, MesActual.Month, 1);
        int offset = ((int)primerDiaDelMes.DayOfWeek + 6) % 7;
        DiasDelCalendario = Enumerable.Range(0, 42).Select(i => primerDiaDelMes.AddDays(i - offset));
    }

    // ---- TAREAS (mantenidas) ----
    void ToggleSubtask(CategoryModel cat, SubtaskModel st)
    {
        st.IsDone = !st.IsDone;
        if (st.Subtasks != null && st.Subtasks.Any())
            st.Subtasks.ForEach(s2 => s2.IsDone = st.IsDone);
    }

    void ToggleInnerSubtask(CategoryModel cat, SubtaskModel parent, SubtaskModel inner)
    {
        inner.IsDone = !inner.IsDone;
        parent.IsDone = parent.Subtasks.All(x => x.IsDone);
    }

    bool AllCompleted(CategoryModel cat)
    {
        return cat.Subtasks != null && cat.Subtasks.Any()
            && cat.Subtasks.All(st => st.IsDone && (st.Subtasks == null || st.Subtasks.All(s2 => s2.IsDone)));
    }

    int RemainingCount(CategoryModel cat)
    {
        if (cat.Subtasks == null) return 0;
        int count = 0;
        foreach (var st in cat.Subtasks)
        {
            if (!st.IsDone) count++;
            if (st.Subtasks != null) count += st.Subtasks.Count(s => !s.IsDone);
        }
        return count;
    }

    void MarkAll(CategoryModel cat, bool done)
    {
        foreach (var st in cat.Subtasks)
        {
            st.IsDone = done;
            if (st.Subtasks != null) st.Subtasks.ForEach(s2 => s2.IsDone = done);
        }
    }

    // ---- Edit / Delete (mantengo tus handlers) ----
    void EditSubtask(CategoryModel cat, SubtaskModel st)
    {
        Console.WriteLine($"Editar actividad: {st.Title} en {cat.Name}");
    }

    void DeleteSubtask(CategoryModel cat, SubtaskModel st)
    {
        cat.Subtasks.Remove(st);
        CargarTareasPorFecha();
    }

    void EditInnerSubtask(CategoryModel cat, SubtaskModel parent, SubtaskModel inner)
    {
        Console.WriteLine($"Editar subtarea: {inner.Title} en {parent.Title}");
    }

    void DeleteInnerSubtask(CategoryModel cat, SubtaskModel parent, SubtaskModel inner)
    {
        parent.Subtasks.Remove(inner);
    }

    void OpenEditModal(CategoryModel cat, SubtaskModel st)
    {
        // abrir modal de edición si se requiere
    }

    void OpenEditInnerModal(CategoryModel cat, SubtaskModel parent, SubtaskModel inner)
    {
        // abrir modal de edición si se requiere
    }

    void CheckSave()
    {
        // guardar cambios (si implementas edición)
    }

    private void AgregarTarea(ReusableModal.TareaCreada nueva)
    {
        var categoria = Categories.FirstOrDefault(c => (nueva.Tipo == "Administrativa" && c.Name == "Tareas "));

        if (categoria != null)
        {
            var nuevaSubtask = new SubtaskModel
            {
                Title = nueva.Titulo,
                IsDone = false,
                Subtasks = nueva.Subtareas.Select(s => new SubtaskModel { Title = s, IsDone = false }).ToList()
            };

            categoria.Subtasks.Add(nuevaSubtask);
        }

        StateHasChanged();
    }
}

        
        
        <style>
    /*MODAL INICIO D MODIFICAR*/
    .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width:100%;
        height: 100%;
        background-color: rgba(0,0,0,0.5);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 9999;
        animation: fadeIn 0.25s ease-in-out;
    }

    .modal-card {
        background-color: #ffffff;
        border-radius: 15px;
        width: 980px;
        max-width: 99%;
        padding: 25px 30px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.25);
        animation: slideUp 0.3s ease-in-out;
        max-height: 100vh;
        overflow-y: auto;
    }

    .modal-title {
        margin-bottom: 20px;
        text-align: center;
        font-size: 1.5rem;
        color: #333;
    }

    .form-group {
        margin-bottom: 15px;
    }

        .form-group label {
            font-weight: bold;
            color: #444;
            margin-bottom: 5px;
            display: block;
        }

    .form-control {
        width: 100%;
        padding: 8px 10px;
        border: 1px solid #ccc;
        border-radius: 6px;
        font-size: 0.95rem;
    }

    .historial {
        margin-top: 20px;
    }

        .historial h4 {
            color: #333;
            font-size: 1.1rem;
            margin-bottom: 10px;
        }

    .table {
        width: 100%;
        border-collapse: collapse;
    }

        .table th, .table td {
            border: 1px solid #ddd;
            padding: 6px;
            text-align: center;
            font-size: 0.9rem;
        }

        .table th {
            background-color: #f5f5f5;
            font-weight: bold;
        }

    .modal-footer {
        display: flex;
        justify-content: flex-end;
        gap: 10px;
        margin-top: 15px;
    }

    .btn-guardar {
        background-color: #28a745;
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 8px;
        font-weight: 600;
        transition: background-color 0.2s ease;
    }

        .btn-guardar:hover {
            background-color: #218838;
        }

    .btn-cancelar {
        background-color: #ccc;
        color: #333;
        border: none;
        padding: 8px 16px;
        border-radius: 8px;
        font-weight: 600;
        transition: background-color 0.2s ease;
    }

        .btn-cancelar:hover {
            background-color: #b3b3b3;
        }

    /* Alertas */
    .alerta {
        border-radius: 8px;
        padding: 10px 15px;
        margin-bottom: 15px;
        font-weight: 600;
        text-align: center;
    }

        .alerta.exito {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alerta.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
/*MODAL TERMIO D MODIFICAR*/


    .modal-backdrop {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.5);
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .modal-container {
        background: white;
        padding: 20px;
        width: 420px;
        border-radius: 8px;
    }

    .form-group {
        margin-bottom: 12px;
    }

    .modal-buttons {
        display: flex;
        justify-content: flex-end;
        gap: 10px;
    }

    /* --- Reglas agregadas para el bloque de Órdenes de Trabajo y modal (estéticas) --- */
    .ordenes-workboard {
        width: 100%;
        max-width: 1700px;
        margin: 0 auto;
    }

    .columns-container {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap: 18px;
    }

    .column {
        background: transparent;
        border-radius: 12px;
        padding: 12px;
        min-height: 120px;
        display: flex;
        flex-direction: column;
        gap: 10px;
        align-items: flex-start;
    }

    /* Column accents but without explicit titles */
    .column-normal {
    }

    .column-soon {
    }

    .column-expired {
    }

    .ot-card {
        width: 100%;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
        padding: 10px 12px;
        background: #fff;
        border-radius: 10px;
        box-shadow: 0 6px 18px rgba(0,0,0,0.06);
        border: 1px solid rgba(0,0,0,0.04);
    }

    .ot-left {
        display: flex;
        flex-direction: column;
        gap: 4px;
    }

    .ot-number {
        font-weight: 700;
        font-size: 1rem;
        color: #1f2d3d;
    }

    .ot-date {
        font-size: 0.85rem;
        color: #6b7280;
    }

    .ot-right {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .icon-eye {
        background: none;
        border: none;
        font-size: 1.15rem;
        cursor: pointer;
        padding: 6px;
        border-radius: 8px;
        transition: all .15s;
        color: #1f2d3d;
    }

        .icon-eye:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.08);
        }

    /* Badges */
    .badge {
        padding: 6px 10px;
        border-radius: 999px;
        font-weight: 700;
        font-size: 0.75rem;
    }

    .badge-soon {
        background: rgba(250,204,21,0.1);
        color: #92400e;
    }

    .badge-expired {
        background: rgba(220,53,69,0.08);
        color: #c5303a;
    }

    /* Accents for types (subtle strip on the left of column cards) */
    .column-normal .ot-card {
        border-left: 6px solid rgba(59,130,246,0.06);
    }

    .column-soon .ot-card {
        border-left: 6px solid rgba(250,204,21,0.4);
    }

    .column-expired .ot-card {
        border-left: 6px solid rgba(220,53,69,0.4);
    }

    .ot-soon {
        background: linear-gradient(180deg, rgba(255,250,230,0.6), #fff);
    }

    .ot-expired {
        background: linear-gradient(180deg, rgba(255,235,238,0.6), #fff);
    }

    /* Tasks table minimal (style A) */
    .tasks-table-minimal {
        margin-top: 8px;
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .tasks-row {
        display: grid;
        grid-template-columns: 2fr 4fr 1fr;
        gap: 12px;
        align-items: center;
        padding: 8px 6px;
        border-radius: 8px;
        background: transparent;
    }

    .tasks-header {
        font-weight: 700;
        color: #374151;
        opacity: 0.9;
    }

    .col-name {
        font-size: 0.95rem;
        color: #111827;
    }

    .col-desc {
        font-size: 0.9rem;
        color: #6b7280;
    }

    .col-adv {
        font-weight: 700;
        text-align: right;
        color: #111827;
    }

    /* ---------------- VARIABLES DE COLOR ---------------- */
    .modal-button-container {
        display: flex;
        justify-content: flex-end; /* mueve el botón a la derecha */
        padding: 8px; /* espacio alrededor */
    }

        .modal-button-container button {
            background-color: #4a90e2; /* color azul */
            color: white;
            border: none;
            border-radius: 6px;
            padding: 20px 20px; /* tamaño más pequeño */
            font-size: 14px;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.15);
            transition: all 0.2s ease;
        }

            .modal-button-container button:hover {
                background-color: #357ABD; /* efecto hover */
                transform: translateY(-2px);
            }

    :root {
        --primary-color: #5b5b9e;
        --primary-dark-color: #4a4a81;
        --secondary-color: #6c757d;
        --success-color: #28a745;
        --danger-color: #dc3545;
        --background-color: #f4f7f6;
        --text-color: #343a40;
        --border-color: #ced4da;
        --input-bg-color: #fff;
        --sidebar-bg: #e9ecef;
    }

    /* ---------------- MODAL BASE ---------------- */
    .modal-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.6);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
        opacity: 0;
        visibility: hidden;
        transition: 0.3s;
    }

        .modal-container.visible {
            opacity: 1;
            visibility: visible;
        }

    .modal-content {
        background: var(--input-bg-color);
        border-radius: 12px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.25);
        width: 90%;
        max-width: 1000px;
        height: 90vh;
        max-height: 800px;
        transform: scale(0.95);
        transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        display: flex;
        flex-direction: column;
        overflow: hidden;
    }



    .modal-container.visible .modal-content {
        transform: scale(1);
    }

    /* ---------------- botones de editar ---------------- */
    .subtask-label {
        display: flex;
        align-items: center;
        justify-content: space-between; /* elementos a los extremos */
        gap: 10px;
    }

    .subtask-text {
        flex: 1; /* ocupa todo el espacio disponible */
    }

    .subtask-actions {
        display: flex;
        gap: 6px;
    }

    .inner-actions {
        display: flex;
        justify-content: flex-end;
        gap: 6px;
    }

    .icon-btn {
        width: 32px;
        height: 32px;
        border-radius: 8px;
        border: 1px solid transparent;
        display: flex;
        justify-content: center;
        align-items: center;
        cursor: pointer;
        font-size: 1rem;
        transition: all 0.25s ease;
        background-color: #f8f9fa;
        color: #444;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
    }

        .icon-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
        }

        /* Botón Editar */
        .icon-btn.edit {
            color: #4a7c59; /* verde elegante */
        }

            .icon-btn.edit:hover {
                background-color: #e9f7ef;
                border-color: #4a7c59;
            }

        /* Botón Eliminar */
        .icon-btn.delete {
            color: #c0392b; /* rojo apagado */
        }

            .icon-btn.delete:hover {
                background-color: #fdecea;
                border-color: #c0392b;
            }



    /* ---------------- CABECERA ---------------- */
    .modal-header {
        padding: 1.5rem 2rem;
        border-bottom: 1px solid var(--border-color);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .modal-title {
        font-size: 1.75rem;
        color: var(--primary-color);
        margin: 0;
    }

    .close-button {
        font-size: 2.5rem;
        color: var(--secondary-color);
        cursor: pointer;
    }

        .close-button:hover {
            color: var(--danger-color);
        }

    /* ---------------- CUERPO ---------------- */
    .modal-body-wrapper {
        flex-grow: 1;
        display: flex;
        overflow: hidden;
        background-color: var(--background-color);
    }

    .form-type-selector {
        flex-shrink: 0;
        width: 220px;
        padding: 1.5rem;
        background: var(--sidebar-bg);
        border-right: 1px solid var(--border-color);
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
    }

        .form-type-selector button {
            padding: 0.8rem 1rem;
            border: none;
            background: transparent;
            color: var(--text-color);
            font-weight: 500;
            border-radius: 6px;
            text-align: left;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            cursor: pointer;
            transition: 0.2s;
        }

            .form-type-selector button:hover {
                background: #dee2e6;
            }

            .form-type-selector button.active {
                background: var(--primary-color);
                color: #fff;
                font-weight: bold;
                box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            }

    .form-section-wrapper {
        flex: 1;
        overflow-y: auto;
        padding: 1.5rem 2rem;
    }

    .form-section {
        display: grid;
        grid-template-columns: repeat(2,1fr);
        gap: 1.5rem 2rem;
    }

    .form-group-span-2 {
        grid-column: 1 / -1;
    }

    .section-label {
        font-size: 1.1rem;
        font-weight: bold;
        color: var(--primary-dark-color);
        margin-bottom: 0.75rem !important;
        border-bottom: 1px dashed var(--border-color);
        padding-bottom: 0.5rem;
        display: block;
    }

    /* INPUTS Y TEXTAREA */
    .form-group label {
        display: block;
        font-weight: 600;
        margin-bottom: 0.5rem;
        font-size: 0.95rem;
        color: var(--text-color);
    }

    .form-control {
        width: 100%;
        padding: 0.75rem 1rem;
        border: 1px solid var(--border-color);
        border-radius: 6px;
        font-size: 1rem;
        background: var(--input-bg-color);
    }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.2rem rgba(91,91,158,0.25);
        }

    .tall-textarea {
        min-height: 120px;
        resize: vertical;
    }

    .mt-2 {
        margin-top: 0.5rem;
    }


    /* SUBTAREAS */
    .todo-list {
        list-style: none;
        padding: 0;
        margin-top: 1rem;
    }

        .todo-list li {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.4rem;
            padding: 0.6rem 1rem;
            background: var(--input-bg-color);
            border: 1px solid #e9ecef;
            border-radius: 6px;
        }

        .todo-list input[type="checkbox"] {
            width: 1.1rem;
            height: 1.1rem;
            flex-shrink: 0;
        }

    .delete-button {
        background: none;
        border: none;
        color: #861B2D;
        font-size: 1.5rem;
        cursor: pointer;
        padding: 0;
        line-height: 1;
    }

        .delete-button:hover {
            color: var(--danger-color);
        }

    /* MODAL FOOTER */
    .modal-footer {
        padding: 1rem 2rem;
        border-top: 1px solid var(--border-color);
        display: flex;
        justify-content: flex-end;
        gap: 1rem;
    }

    /* ALERTAS */
    .alert-backdrop {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.4);
        z-index: 1999;
    }

    .alert-container {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: var(--input-bg-color);
        padding: 2rem;
        border-radius: 10px;
        box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        z-index: 2000;
        text-align: center;
        min-width: 350px;
    }

        .alert-container h4 {
            color: var(--primary-color);
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }

    .alert-buttons {
        margin-top: 1.5rem;
        display: flex;
        justify-content: center;
        gap: 1rem;
    }

    .btn-danger {
        background-color: var(--danger-color);
        color: #fff;
    }

    /* SUBTASK LIST / TABLES */
    .table-wrapper {
        margin-left: 36px;
        margin-top: 6px;
    }

    .subtask-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 0.9rem;
    }

        .subtask-table th, .subtask-table td {
            border: 1px solid rgba(0,0,0,0.1);
            padding: 6px 8px;
            text-align: left;
        }

        .subtask-table th {
            background: rgba(0,0,0,0.05);
        }

    /* BLOQUES / CARDS */
    .agenda-container {
        width: 100%; /* Ocupa todo el ancho disponible */
        max-width: 1700px; /* Límite opcional para pantallas muy grandes */
        margin: 18px auto; /* Centrado horizontal */
        font-family: 'Segoe UI', Roboto, Arial, sans-serif;
        display: flex;
        flex-direction: column;
        gap: 20px;
        padding: 0 24px; /* Espacio lateral para que no se pegue a los bordes */
        box-sizing: border-box;
    }

    /* 🔹 Cada bloque individual (card de categoría) */
    .block-card {
        width: 100%;
        min-height: 250px;
        border-radius: 14px;
        background-color: #fff;
        box-shadow: 0 6px 18px rgba(0, 0, 0, 0.08);
        border: 1px solid rgba(0, 0, 0, 0.08);
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        overflow: hidden;
    }

    .block-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 12px 16px;
        cursor: pointer;
    }

    .block-title {
        margin: 0;
        font-size: 1.05rem;
        font-weight: 600;
    }

    .card-body {
        padding: 12px 18px 16px 18px;
        background: rgba(255,255,255,0.7);
        font-size: 1.5rem;
    }

    .subtask-list {
        list-style: none;
        padding: 0;
        margin: 0;
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .subtask-item {
        display: flex;
        flex-direction: column;
        gap: 6px;
    }

    .subtask-label {
        display: flex;
        align-items: center;
        gap: 10px;
    }

        .subtask-label.done .subtask-text {
            text-decoration: line-through;
            opacity: 0.6;
        }

    .done-text {
        font-size: 0.8rem;
        color: rgba(0,0,0,0.45);
        margin-left: 8px;
    }

    .actions {
        margin-top: 12px;
        display: flex;
        gap: 8px;
    }

    .btn {
        padding: 6px 10px;
        border-radius: 8px;
        border: none;
        cursor: pointer;
        font-weight: 600;
        background: #FFFFFF;
    }

        .btn.small {
            font-size: 0.9rem;
            padding: 6px 10px;
        }

        .btn.outline {
            background: #000000;
            border: 1px solid rgba(0,0,0,0.08);
        }

    .badge {
        padding: 6px 10px;
        border-radius: 999px;
        font-weight: 700;
        font-size: 0.85rem;
    }

    .completado {
        background: rgba(255, 255, 255);
        color: #1E1E1E;
        border: 1.5px solid rgba(34,197,94,0.18);
    }

    .pendiente {
        background: rgba(250,204,21,0.1);
        color: #92400e;
        border: 1px solid rgba(0,0,0,0.05);
    }

    /* PASTEL COLORS */
    .pastel-blue .block-header {
        background: linear-gradient(90deg, #FFD1DC, #FFD1DC);
    }

    .pastel-green .block-header {
        background: linear-gradient(90deg, #eaf8f1, #f8fefb);
    }

    .pastel-mauve .block-header {
        background: linear-gradient(90deg, #f3edf7, #fbf8fd);
    }

    .pastel-beige .block-header {
        background: linear-gradient(90deg, #f9f6f2, #fefdfb);
    }

    .pastel-teal .block-header {
        background: linear-gradient(90deg, #e9f9f7, #f7fdfd);
    }

    /* FECHA Y CALENDARIO */
    .top-bar-container {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .fecha-header {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 10px;
        flex-grow: 1;
        position: relative;
    }

    .fecha-texto {
        font-size: 1.2rem;
        font-weight: 600;
        min-width: 180px;
        text-align: center;
    }

    .add-task-btn {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: #3b82f6;
        color: white;
        font-size: 20px;
        border: none;
        cursor: pointer;
        box-shadow: 0 2px 5px rgba(0,0,0,0.15);
        flex-shrink: 0;
    }

    .calendar-btn {
        background: none;
        border: none;
        font-size: 1.5rem;
        cursor: pointer;
    }

    .calendar-wrapper {
        position: relative;
        display: inline-block;
    }

    .modal-popover {
        position: absolute;
        top: 0;
        left: 100%;
        z-index: 1000;
        background: white;
        border: 1px solid #ccc;
        border-radius: 8px;
        padding: 10px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        margin-left: 10px;
        width: 250px;
    }

    .calendar-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
        font-size: 0.9em;
    }

    .calendar-grid {
        display: grid;
        grid-template-columns: repeat(7,1fr);
        gap: 3px;
        text-align: center;
        font-size: 0.9em;
    }

    .calendar-week-day {
        padding: 4px 2px;
    }

    .calendar-day {
        padding: 5px 3px;
        cursor: pointer;
        border-radius: 4px;
        transition: 0.2s;
    }

        .calendar-day:hover {
            background: #f0f0f0;
        }

    .calendar-other-month {
        opacity: 0.5;
    }

    .calendar-today {
        font-weight: bold;
        background: #d1e7ff;
        color: #0d6efd;
    }

    /* COLORES BLOQUES */
    .verde-menta .block-header {
        background: #B5EAD7;
    }

    .naranja-melocoton .block-header {
        background: #FFDAC1;
    }

    .verde-lima .block-header {
        background: #E2F0CB;
    }

    .azul-lavanda .block-header {
        background: #E2F0CB;
    }

    .azul-morado .block-header {
        background: #D7D1DD;
    }

    .rosa-pastel .block-header {
        background: #FDE2E4;
    }

    .rosa-administrativa .block-header {
        background-color: #FFD1DC;
    }

    /* MEDIA QUERIES ---------------- */
    @@media (max-width:992px) {
        .modal-content {
            max-width: 700px;
            height: 95vh;
            max-height: 95vh;
        }

        .modal-body-wrapper {
            flex-direction: column;
        }

        .form-type-selector {
            width: 100%;
            flex-direction: row;
            border-right: none;
            border-bottom: 1px solid var(--border-color);
            padding: 1rem 1.5rem;
            overflow-x: auto;
            white-space: nowrap;
            gap: 0.5rem;
        }

            .form-type-selector button {
                flex-shrink: 0;
                padding: 0.6rem 0.8rem;
            }

        .form-section-wrapper {
            padding: 1.5rem;
        }

        .form-section {
            grid-template-columns: 1fr;
            gap: 1.5rem;
        }

        .form-group-span-2 {
            grid-column: auto;
        }

        .form-group-inline {
            flex-direction: column;
            gap: 1rem;
        }

        .inline-control-group {
            min-width: 100%;
        }
    }

</style>