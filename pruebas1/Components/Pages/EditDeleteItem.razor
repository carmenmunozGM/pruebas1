﻿@using pruebas1.Components.Models
@using pruebas1.Servicios
@inject AgendaService AgendaService

<!-- BOTONES EDITAR / ELIMINAR -->

    <button class="icon-btn edit" title="Editar">
        <i class="bi bi-pencil"></i>
    </button>

    <button class="icon-btn delete" title="Eliminar">
        <i class="bi bi-trash3"></i>
    </button>




@if (MostrarModal)
{
    <div class="ed-overlay">
        <div class="ed-modal" @onclick:stopPropagation="true">
            <h3>Editar @Tipo</h3>

            <input @bind="EditModel.Titulo" placeholder="Título" />
            <textarea @bind="EditModel.Descripcion" placeholder="Descripción"></textarea>

            <input type="datetime-local"
                   @bind-value="EditModel.FechaInicio"
                   @bind-value:format="yyyy-MM-ddTHH:mm" />

            <input type="datetime-local"
                   @bind-value="EditModel.FechaFin"
                   @bind-value:format="yyyy-MM-ddTHH:mm" />

            <div class="ed-footer">
                <button @onclick="Guardar">Guardar</button>
                <button @onclick="Cerrar">Cancelar</button>
            </div>
        </div>
    </div>
}

@code {

    [Parameter] public EditableItemModel EditModel { get; set; } = new();
    [Parameter] public ItemTipo Tipo { get; set; }

    [Parameter] public EventCallback OnUpdated { get; set; }
    [Parameter] public EventCallback OnDeleted { get; set; }

    bool MostrarModal;

    void AbrirEditar()
    {
        Console.WriteLine("🧨 ABRIR MODAL");
        MostrarModal = true;
    }

    void Cerrar() => MostrarModal = false;

    async Task Guardar()
    {
        Console.WriteLine($"✏️ GUARDAR {Tipo} ID={EditModel.Id}");

        if (Tipo == ItemTipo.Evento)
            await AgendaService.EditarEventoAsync(EditModel.Id, EditModel);
        else
            await AgendaService.EditarTareaAsync(EditModel.Id, EditModel);

        MostrarModal = false;
        await OnUpdated.InvokeAsync();
    }

    async Task Eliminar()
    {
        Console.WriteLine($"🗑️ ELIMINAR {Tipo} ID={EditModel.Id}");

        if (Tipo == ItemTipo.Evento)
            await AgendaService.EliminarEventoAsync(EditModel.Id);
        else
            await AgendaService.EliminarTareaAsync(EditModel.Id);

        await OnDeleted.InvokeAsync();
    }
}

            <style>
    .icon-btn {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        border: none;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 16px;
        transition: all 0.25s ease;
    }

        .icon-btn.edit {
            background: #fff;
            color: #135330;
            border: 1px solid #135330; /* 👈 borde negro */
        }

            .icon-btn.edit:hover {
                background: #fff;
                transform: scale(1.08);
            }

        .icon-btn.delete {
            background: #fff;
            color: #A82518;
            border: 1px solid #A82518; /* 👈 borde negro */
        }

            .icon-btn.delete:hover {
                background: #fff;
                transform: scale(1.08);
            }

            </style>