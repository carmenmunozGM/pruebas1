@page "/semanal"
@using System.Globalization
@using pruebas1.Servicios
@using pruebas1.Components.DTOs
@inject AgendaService AgendaService
@inject OrdenTrabajoService OrdenService
@inject IJSRuntime JSRuntime



<div class="agenda-container">

    <header class="agenda-header">
        <button class="btn" @onclick="PrevWeek">
            <span class="arrow">&#9664;</span> Semana anterior
        </button>

        <div class="header-center">
            <h1>Semana @WeekNumber - @MonthName @CurrentDate.Year</h1>
        </div>

        <button class="btn primary" @onclick="NextWeek">
            Semana siguiente <span class="arrow">&#9654;</span>
        </button>
    </header>

    <div class="days-grid weekly">
        @foreach (var day in Days.Where(d => d.Date.DayOfWeek != DayOfWeek.Sunday))
        {
            <div class="day-card">
                <div class="day-header">
                    <span class="day-name">@day.Date.ToString("dddd", new CultureInfo("es-ES"))</span>
                    <span class="day-date">@day.Date.ToString("dd")</span>
                </div>

                <div class="blocks-list">
                    @foreach (var block in day.Blocks)
                    {
                        <div class="list-item" style="background-color:@block.Color">
                            <div class="list-title" @onclick="() => ToggleBlock(block)">
                                <span>@block.Title</span>

                                <span class="badge-pendientes">
                                    @PendingCount(block)

                                </span>

                                <span class="chev">@((block.IsExpanded ? "▼" : "►"))</span>
                            </div>

                            @if (block.IsExpanded)
                            {
                                <ul class="subtasks">
                                    @foreach (var taskObj in block.SubTasks)
                                    {
                                        <li class="task-item">
                                            @switch (taskObj)
                                            {
                                                case ClientServiceTask cs:
                                                    <input type="checkbox"
                                                           checked="@cs.IsCompleted"
                                                           @onchange="(e) => ToggleCompleteClient(cs, e)"
                                                           @onclick:stopPropagation />
                                                    <span class="task-name @(cs.IsCompleted ? "completed" : "")"
                                                          @onclick="() => OpenClientModal(cs)">
                                                        @cs.CompanyName
                                                    </span>
                                                    break;

                                                case SelfAssessment sa:
                                                    <input type="checkbox"
                                                           @onchange="(e) => ToggleCompleteSelf(sa, e)"
                                                           checked="@sa.IsCompleted"
                                                           @onclick:stopPropagation />
                                                    <span class="task-name @(sa.IsCompleted ? "completed" : "")"
                                                          @onclick="() => OpenTaskModal(sa, false)">
                                                        @sa.ActivityName
                                                    </span>
                                                    break;

                                                case BaseTask bt:
                                                    if (block.Title != "Órdenes de Trabajo")
                                                    {
                                                        <input type="checkbox"
                                                               @onchange="(e) => ToggleComplete(bt, e)"
                                                               checked="@bt.IsCompleted"
                                                               @onclick:stopPropagation />
                                                        <span class="task-name @(bt.IsCompleted ? "completed" : "")"
                                                              @onclick="() => OpenTaskModal(bt, false)">
                                                            @bt.Name
                                                        </span>
                                                        <div class="task-actions">
                                                            <button class="edit-btn"
                                                                    title="Editar"
                                                                    @onclick="(MouseEventArgs e) => OpenTaskModal(bt, true)"
                                                                    @onclick:stopPropagation="true">
                                                                ✏️
                                                            </button>

                                                            <button class="delete-btn"
                                                                    title="Eliminar"
                                                                    @onclick="(MouseEventArgs e) => ConfirmDelete(bt)"
                                                                    @onclick:stopPropagation="true">
                                                                🗑️
                                                            </button>
                                                        </div>
                                                    }
                                                    else
                                                    {
                                                        <span class="workorder">@bt.Name</span>
                                                    }
                                                    break;

                                                default:
                                                    <span>Desconocido</span>
                                                    ;
                                                    break;
                                            }
                                        </li>
                                    }
                                </ul>
                            }
                        </div>
                    }
                </div>
            </div>
        }
    </div>
</div>

<!-- Modal de Tarea (editar/ver) -->
@if (IsModalOpen && SelectedTaskObject != null)
{
    <div class="modal-backdrop" @onclick="CloseTaskModal"></div>

    <div class="modal-content" @onclick:stopPropagation>
        <div class="modal-header">
            <h2>@GetModalTitle()</h2>
            <button class="close-btn" @onclick="CloseTaskModal">&times;</button>
        </div>

        <div class="modal-body">
            @if (SelectedTaskObject is BaseTask bt)
            {
                <div class="form-group">
                    <label>Actividad:</label>
                    <input type="text" @bind="bt.Name" disabled="@(!IsEditMode)" />
                </div>
                <div class="form-group">
                    <label>Descripción:</label>
                    <textarea @bind="bt.Description" disabled="@(!IsEditMode)"></textarea>
                </div>
                <div class="form-group">
                    <label>Prioridad:</label>
                    <select @bind="bt.Priority" disabled="@(!IsEditMode)">
                        <option value="Alta">🔴 Alta</option>
                        <option value="Media">🟡 Media</option>
                        <option value="Baja">🟢 Baja</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Recurrencia:</label>
                    <select @bind="bt.Recurrence" disabled="@(!IsEditMode)">
                        <option value="No repetir">No repetir</option>
                        <option value="Diario">Diario</option>
                        <option value="Semanal">Semanal</option>
                        <option value="Quincenal">Quincenal</option>
                        <option value="Mensual">Mensual</option>
                        <option value="Anual">Anual</option>
                    </select>
                </div>
                <div class="form-group inline">
                    <label>Fecha inicio</label>
                    <input type="date" @bind="bt.StartDate" disabled="@(!IsEditMode)" />
                </div>
                <div class="form-group inline">
                    <label>Fecha fin</label>
                    <input type="date" @bind="bt.DueDate" disabled="@(!IsEditMode)" />
                </div>
            }
            else if (SelectedTaskObject is SelfAssessment sa)
            {
                <div class="form-group">
                    <label>Actividad:</label>
                    <p class="read-only-field">@sa.ActivityName</p>
                </div>
            }
        </div>

        <div class="modal-footer">
            @if (IsEditMode)
            {
                <button class="action-btn save" @onclick="SaveTask">💾 Guardar</button>
                <button class="action-btn cancel" @onclick="CancelEdit">❌ Cancelar</button>
            }
            else
            {
                <button class="action-btn save" @onclick="() => IsModalOpen = false">✔️ Cerrar</button>
            }
        </div>
    </div>
}
@if (IsClientModalOpen && SelectedClientTask != null)
{
    <div class="modal-backdrop" @onclick="CloseClientModal"></div>

    <div class="modal-content" @onclick:stopPropagation>
        <div class="modal-header">
            <h2>Detalles del Cliente</h2>
            <button class="close-btn" @onclick="CloseClientModal">&times;</button>
        </div>

        <div class="modal-body">
            <div class="form-group">
                <label>Empresa</label>
                <p class="read-only-field">@SelectedClientTask.CompanyName</p>
            </div>

            <div class="form-group">
                <label>Actividad</label>
                <p class="read-only-field">@SelectedClientTask.ActivityDetail</p>
            </div>
        </div>

        <div class="modal-footer">
            <button class="action-btn save" @onclick="CloseClientModal">Cerrar</button>
        </div>
    </div>
}

<!-- Modal de Confirmación de Borrado -->
@if (ShowConfirmDelete)
{
    <div class="modal-backdrop" @onclick="() => ShowConfirmDelete = false"></div>
    <div class="confirm-modal" @onclick:stopPropagation>
        <h3>¿Eliminar tarea?</h3>
        <p>¿Estás seguro que quieres eliminar "<strong>@TaskToDelete?.Name</strong>"?</p>
        <div class="confirm-actions">
            <button class="action-btn save" @onclick="() => { ShowConfirmDelete = false; TaskToDelete = null; }">Cancelar</button>
            <button class="action-btn cancel" @onclick="() => DeleteConfirmedAsync()">Eliminar</button>
        </div>
    </div>
}

<!-- Toast -->
@if (ShowToast)
{
    <div class="toast">@ToastMessage</div>
}

@code {
    // ---------- Tipos internos para la vista ----------
    enum BlockType { AdminTask, WorkOrder, GeneralTask, SelfAssessment }

    class DayColumn
    {
        public DateTime Date { get; set; }
        public List<Block> Blocks { get; set; } = new();
    }

    class Block
    {
        public string Title { get; set; } = "";
        public List<object> SubTasks { get; set; } = new();
        public string Color { get; set; } = "#fff";
        public bool IsExpanded { get; set; } = false;
    }

    class BaseTask
    {
        public Guid Id { get; set; } = Guid.NewGuid();
        public int ApiId { get; set; } = 0;
        public BlockType Type { get; set; }
        public string Name { get; set; } = "";
        public string Description { get; set; } = "";
        public string Priority { get; set; } = "Media";
        public string Recurrence { get; set; } = "No repetir";
        public bool IsCompleted { get; set; } = false;
        public DateTime StartDate { get; set; } = DateTime.Today;
        public DateTime DueDate { get; set; } = DateTime.Today;
        public List<object> SubTasks { get; set; } = new();
        public Block ParentBlock { get; set; }
    }

    class SelfAssessment
    {
        public Guid Id { get; set; } = Guid.NewGuid();
        public string ActivityName { get; set; } = "";
        public bool IsCompleted { get; set; } = false;
        public Block ParentBlock { get; set; }
    }

    class ClientServiceTask
    {
        public Guid Id { get; set; } = Guid.NewGuid();
        public string CompanyName { get; set; } = "";
        public string ActivityDetail { get; set; } = "";
        public bool IsCompleted { get; set; } = false;
        public Block ParentBlock { get; set; }
    }

    // ---------- Estado del componente ----------
    List<DayColumn> Days = new();
    DateTime CurrentDate = DateTime.Today;

    object SelectedTaskObject { get; set; }
    bool IsModalOpen { get; set; } = false;
    bool IsEditMode { get; set; } = false;

    // Confirm delete
    bool ShowConfirmDelete { get; set; } = false;
    BaseTask TaskToDelete { get; set; }

    // Toast
    bool ShowToast { get; set; } = false;
    string ToastMessage { get; set; } = "";

    int WeekNumber => CultureInfo.CurrentCulture.Calendar.GetWeekOfYear(CurrentDate, CalendarWeekRule.FirstFourDayWeek, DayOfWeek.Monday);
    string MonthName => CultureInfo.GetCultureInfo("es-ES").DateTimeFormat.GetMonthName(CurrentDate.Month);

    protected override async Task OnInitializedAsync()
    {
        await LoadWeek(CurrentDate);
    }

    async Task PrevWeek()
    {
        CurrentDate = CurrentDate.AddDays(-7);
        await LoadWeek(CurrentDate);
    }

    async Task NextWeek()
    {
        CurrentDate = CurrentDate.AddDays(7);
        await LoadWeek(CurrentDate);
    }

    // ---------- Carga principal ----------
    async Task LoadWeek(DateTime reference)
    {
        Days.Clear();
        var monday = StartOfWeek(reference, DayOfWeek.Monday);

        // Crear días y bloques (autoeval y servicio al cliente estáticos)
        for (int i = 0; i < 7; i++)
        {
            var date = monday.AddDays(i).Date;
            var day = new DayColumn { Date = date };

            // Bloque 1 - Tareas / Eventos (dinámico)
            day.Blocks.Add(new Block { Title = "Tareas", Color = "#FFD1DC", IsExpanded = true });

            // Bloque 2 - Órdenes de Trabajo (dinámico)
            day.Blocks.Add(new Block { Title = "Órdenes de Trabajo", Color = "#FFDAC1", IsExpanded = false });

            // Bloque 3 - Autoevaluación (ESTÁTICO)
            var autoBlock = new Block { Title = "Autoevaluación", Color = "#E2F0CB", IsExpanded = false };
            autoBlock.SubTasks.Add(new SelfAssessment { ActivityName = "Autoevaluación ejemplo 1", ParentBlock = autoBlock });
            autoBlock.SubTasks.Add(new SelfAssessment { ActivityName = "Autoevaluación ejemplo 2", ParentBlock = autoBlock });
            day.Blocks.Add(autoBlock);

            // Bloque 4 - Servicio al Cliente (ESTÁTICO)
            var clienteBlock = new Block { Title = "Servicio al Cliente", Color = "#D7D1DD", IsExpanded = false };
            clienteBlock.SubTasks.Add(new ClientServiceTask { CompanyName = "Cliente ejemplo A", ActivityDetail = "Seguimiento semanal", ParentBlock = clienteBlock });
            clienteBlock.SubTasks.Add(new ClientServiceTask { CompanyName = "Cliente ejemplo B", ActivityDetail = "Revisión de pendientes", ParentBlock = clienteBlock });
            day.Blocks.Add(clienteBlock);

            Days.Add(day);
        }

        // Rango de la semana (por fechaFin)
        var startOfWeek = monday.Date;
        var endOfWeek = monday.AddDays(6).Date;

        // Obtener id de agenda (usa tu servicio)
        var agendas = await AgendaService.ObtenerAgendaAsignadasAsync();
        var idAgenda = agendas.FirstOrDefault();

        // 1) Obtener tareas (api) y eventos (api)
        List<object> tareasApi = new();
        try
        {
            if (idAgenda > 0)
            {
                // el método puede devolver TareaApi o TareaApiDto según tu proyecto; usamos object y mapeamos
                var tareas = await AgendaService.ObtenerTareasApi(idAgenda);
                if (tareas != null)
                    tareasApi.AddRange(tareas);
            }
        }
        catch { /* ignore */ }

        try
        {
            if (idAgenda > 0)
            {
                var eventos = await AgendaService.ObtenerEventos(idAgenda);
                if (eventos != null)
                    tareasApi.AddRange(eventos);
            }
        }
        catch { /* ignore */ }

        // Mapear y filtrar por fechaFin (acepta propiedades fechaFin o fechaFinal o fechaFinal en ordenes)
        foreach (var obj in tareasApi)
        {
            DateTime? fechaFin = TryGetDateTime(obj, "fechaFin") ?? TryGetDateTime(obj, "fechaFinal") ?? TryGetDateTime(obj, "fechaConclusion");
            if (fechaFin == null) continue;
            if (fechaFin.Value.Date < startOfWeek || fechaFin.Value.Date > endOfWeek) continue;

            var day = Days.FirstOrDefault(d => d.Date.Date == fechaFin.Value.Date);
            if (day == null) continue;

            // Obtener titulo/nombre
            var titulo = TryGetString(obj, "titulo") ?? TryGetString(obj, "strClave") ?? TryGetString(obj, "tituloEvento") ?? TryGetString(obj, "Name") ?? "Sin título";

            var descripcion = TryGetString(obj, "descripcion") ?? TryGetString(obj, "strObjetivoOtro") ?? "";

            var apiId = TryGetInt(obj, "idAgenda") ?? TryGetInt(obj, "id") ?? 0;
            var esEvento = TryGetBool(obj, "esEvento") ?? TryGetBool(obj, "esRecurrente") == false ? false : TryGetBool(obj, "esEvento") ?? false;

            var mapped = new BaseTask
            {
                ApiId = apiId,
                Name = esEvento ? "[Evento] " + titulo : titulo,
                Description = descripcion,
                StartDate = TryGetDateTime(obj, "fechaInicio") ?? fechaFin.Value,
                DueDate = fechaFin.Value,
                IsCompleted = TryGetBool(obj, "completada") ?? false,
                Priority = TryGetString(obj, "prioridadTitulo") ?? (TryGetInt(obj, "idPrioridad")?.ToString() ?? "Media"),
                Type = BlockType.GeneralTask
            };

            mapped.ParentBlock = day.Blocks[0];
            day.Blocks[0].SubTasks.Add(mapped);
        }

        // 2) Obtener órdenes de trabajo y mapear
        List<OrdenTrabajoDTO> ordenes = new();
        try
        {
            var ordProx = await OrdenService.GetOrdenesProximas();
            if (ordProx != null) ordenes.AddRange(ordProx);
            var ordHoy = await OrdenService.GetOrdenesHoy();
            if (ordHoy != null) ordenes.AddRange(ordHoy);
            var ordVenc = await OrdenService.GetOrdenesVencidas();
            if (ordVenc != null) ordenes.AddRange(ordVenc);
        }
        catch { /* ignore */ }

        foreach (var o in ordenes)
        {
            DateTime fecha = o.fechaFinal.Date;
            if (fecha < startOfWeek || fecha > endOfWeek) continue;
            var day = Days.FirstOrDefault(d => d.Date.Date == fecha);
            if (day == null) continue;

            var wt = new BaseTask
            {
                ApiId = o.id,
                Name = $"{o.strClave} - {o.nombreCliente}",
                Description = o.strObjetivoOtro ?? o.strValor,
                StartDate = o.dteFechaSolicitud,
                DueDate = o.fechaFinal,
                IsCompleted = string.Equals(o.estado, "Completado", StringComparison.OrdinalIgnoreCase),
                Type = BlockType.WorkOrder,
                ParentBlock = day.Blocks[1]
            };

            day.Blocks[1].SubTasks.Add(wt);
        }

        StateHasChanged();
    }

    // ---------- Helpers para leer propiedades de objetos retornados por el servicio ----------
    DateTime? TryGetDateTime(object obj, string propName)
    {
        try
        {
            var t = obj.GetType();
            var p = t.GetProperty(propName);
            if (p == null) return null;
            var val = p.GetValue(obj);
            if (val == null) return null;

            if (val is DateTime dt) return dt;
            if (val is string s)
            {
                if (DateTime.TryParse(s, out var parsed)) return parsed;
                // intentar formatos comunes
                if (DateTime.TryParseExact(s, "yyyy-MM-ddTHH:mm:ss", CultureInfo.InvariantCulture, DateTimeStyles.None, out parsed)) return parsed;
                if (DateTime.TryParseExact(s, "yyyy-MM-dd", CultureInfo.InvariantCulture, DateTimeStyles.None, out parsed)) return parsed;
            }
        }
        catch { }
        return null;
    }

    string TryGetString(object obj, string propName)
    {
        try
        {
            var p = obj.GetType().GetProperty(propName);
            if (p == null) return null;
            var v = p.GetValue(obj);
            return v?.ToString();
        }
        catch { return null; }
    }

    int? TryGetInt(object obj, string propName)
    {
        try
        {
            var p = obj.GetType().GetProperty(propName);
            if (p == null) return null;
            var v = p.GetValue(obj);
            if (v == null) return null;
            if (v is int i) return i;
            if (int.TryParse(v.ToString(), out var parsed)) return parsed;
        }
        catch { }
        return null;
    }

    bool? TryGetBool(object obj, string propName)
    {
        try
        {
            var p = obj.GetType().GetProperty(propName);
            if (p == null) return null;
            var v = p.GetValue(obj);
            if (v == null) return null;
            if (v is bool b) return b;
            if (bool.TryParse(v.ToString(), out var parsed)) return parsed;
        }
        catch { }
        return null;
    }

    DateTime StartOfWeek(DateTime dt, DayOfWeek startOfWeek)
    {
        int diff = (7 + (dt.DayOfWeek - startOfWeek)) % 7;
        return dt.AddDays(-1 * diff).Date;
    }

    // ---------- UI helpers y acciones ----------
    void ToggleBlock(Block block) => block.IsExpanded = !block.IsExpanded;

    int PendingCount(Block block)
    {
        int count = 0;
        foreach (var t in block.SubTasks)
        {
            switch (t)
            {
                case BaseTask bt:
                    if (!bt.IsCompleted) count++;
                    break;
                case SelfAssessment sa:
                    if (!sa.IsCompleted) count++;
                    break;
                case ClientServiceTask cs:
                    if (!cs.IsCompleted) count++;
                    break;
            }
        }
        return count;
    }

    async Task ToggleComplete(BaseTask bt, ChangeEventArgs e)
    {
        if (e?.Value is bool b) bt.IsCompleted = b;
        else
        {
            bool parsed = false;
            if (e?.Value is string s) parsed = s == "true" || s == "on";
            bt.IsCompleted = parsed;
        }

        await ShowTemporaryToastAsync(bt.IsCompleted ? $"Marcaste '{bt.Name}' como completada" : $"Desmarcaste '{bt.Name}'");
        // TODO: Llamar a AgendaService para persistir cambio si lo deseas
    }

    async Task ToggleCompleteSelf(SelfAssessment sa, ChangeEventArgs e)
    {
        if (e?.Value is bool b) sa.IsCompleted = b;
        else
        {
            bool parsed = false;
            if (e?.Value is string s) parsed = s == "true" || s == "on";
            sa.IsCompleted = parsed;
        }
        await ShowTemporaryToastAsync(sa.IsCompleted ? "Autoevaluación marcada" : "Autoevaluación desmarcada");
    }

    async Task ToggleCompleteClient(ClientServiceTask cs, ChangeEventArgs e)
    {
        if (e?.Value is bool b) cs.IsCompleted = b;
        else
        {
            bool parsed = false;
            if (e?.Value is string s) parsed = s == "true" || s == "on";
            cs.IsCompleted = parsed;
        }
        await ShowTemporaryToastAsync(cs.IsCompleted ? "Actividad completada" : "Actividad desmarcada");
    }

    void OpenTaskModal(object task, bool editMode)
    {
        SelectedTaskObject = task;
        IsModalOpen = true;
        IsEditMode = editMode;
    }

    void CloseTaskModal()
    {
        SelectedTaskObject = null;
        IsModalOpen = false;
        IsEditMode = false;
    }

    void OpenClientModal(ClientServiceTask cs)
    {
        SelectedClientTask = cs;
        IsClientModalOpen = true;
    }

    void CloseClientModal()
    {
        SelectedClientTask = null;
        IsClientModalOpen = false;
    }
    private ClientServiceTask? SelectedClientTask { get; set; }
    private bool IsClientModalOpen { get; set; } = false;

    

    string GetModalTitle()
    {
        if (SelectedTaskObject is BaseTask bt)
            return bt.Type switch
            {
                BlockType.AdminTask => "Tarea Administrativa",
                BlockType.GeneralTask => "Tarea Operativa",
                _ => "Detalles de la tarea"
            };
        else if (SelectedTaskObject is SelfAssessment)
            return "Registro de Autoevaluación";
        return "Detalles";
    }

    void ConfirmDelete(BaseTask bt)
    {
        TaskToDelete = bt;
        ShowConfirmDelete = true;
    }

    async Task DeleteConfirmedAsync()
    {
        if (TaskToDelete != null)
        {
            TaskToDelete.ParentBlock?.SubTasks.Remove(TaskToDelete);
            await ShowTemporaryToastAsync("Tarea eliminada");
        }
        TaskToDelete = null;
        ShowConfirmDelete = false;
    }

    async Task SaveTask()
    {
        // Aquí puedes mapear y mandar a AgendaService para actualizar
        IsEditMode = false;
        IsModalOpen = false;

        if (SelectedTaskObject is BaseTask bt)
        {
            await ShowSuccessAlert($"✅ La tarea '{bt.Name}' se guardó correctamente");
        }
    }

    void CancelEdit()
    {
        IsEditMode = false;
    }

    async Task ShowSuccessAlert(string message)
    {
        await JSRuntime.InvokeVoidAsync("Swal.fire", new
        {
            icon = "success",
            title = message,
            showConfirmButton = true,
            confirmButtonColor = "#0B3C4A",
            timer = 2000
        });
    }

    async Task ShowTemporaryToastAsync(string message, int milliseconds = 1600)
    {
        ToastMessage = message;
        ShowToast = true;
        StateHasChanged();
        await Task.Delay(milliseconds);
        ShowToast = false;
        StateHasChanged();
    }
}
<style>
    /* Contenedor principal */
    .agenda-container {
        font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
        background: #fff;
        padding: 18px;
        border-radius: 12px;
        width: 100vw;
        height: 100vh;
        display: flex;
        flex-direction: column;
        box-sizing: border-box;
        overflow: hidden;
    }

    .badge-pendientes {
        background-color: rgba(255, 255, 255, 0.5);
        color: #333;
        font-weight: 700;
        padding: 3px 10px;
        border-radius: 12px;
        font-size: 12px;
        /* Corregido */
        display: flex;
        justify-content: center;
        align-items: center;
        min-width: 28px; /* Tamaño perfecto */
        height: 22px; /* Mantiene forma uniforme */
    }

    /* Header */
    .agenda-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 12px;
        margin-bottom: 12px;
    }

    .header-center {
        display: flex;
        flex-direction: column;
        align-items: center;
        flex: 1 1 auto;
    }

        .header-center h1 {
            margin: 0;
            font-size: 30px;
            font-weight: 700;
        }

    .month-pill {
        margin-top: 6px;
        background: linear-gradient(90deg,#f7f7f7,#fff);
        padding: 6px 10px;
        border-radius: 999px;
        font-weight: 600;
        color: #0b3c4a;
        box-shadow: 0 2px 6px rgba(11,60,74,0.06);
    }

    /* Botones */
    .btn {
        background: linear-gradient(90deg,#1e7a3a,#0b3c4a);
        color: white;
        border: none;
        padding: 8px 12px;
        border-radius: 8px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 8px;
        min-width: 140px;
        justify-content: center;
    }

        .btn.primary {
            background: linear-gradient(90deg,#1e7a3a,#0b3c4a);
        }

        .btn:hover {
            background: linear-gradient(90deg, #155d2b, #062b35); /* tonos más oscuros */
            color: white; /* asegura que el texto siga siendo blanco */
            transform: translateY(-1px);
        }

    .arrow {
        font-weight: 700;
    }

    /* Grid de días */
    .days-grid.weekly {
        display: grid;
        grid-template-columns: repeat(6, 1fr);
        gap: 12px;
        flex-grow: 1;
        overflow-y: auto;
        padding-right: 6px;
    }

    /* Tarjetas de día */
    .day-card {
        background: #f9fafb;
        border-radius: 12px;
        padding: 12px;
        display: flex;
        flex-direction: column;
        gap: 10px;
        max-height: 100%;
        overflow-y: auto;
    }

    /* Header del día */
    .day-header {
        display: flex;
        justify-content: space-between;
        font-weight: 700;
        text-transform: capitalize;
    }

    /* Lista de bloques */
    .blocks-list {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    /* Bloques individuales */
    .list-item {
        border-radius: 10px;
        padding: 10px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.04);
        transition: transform .12s ease;
    }

        .list-item:hover {
            transform: translateY(-3px);
        }

    .list-title {
        font-weight: 700;
        margin-bottom: 8px;
        user-select: none;
        cursor: pointer;
        display: grid;
        grid-template-columns: 1fr auto auto; /* Título | Badge | Flecha */
        align-items: center; /* Alinea TODO verticalmente al centro */
        gap: 8px;
    }


    .chev {
        font-size: 12px;
        opacity: 0.8;
        margin-left: 10px;
    }

    /* Subtareas */
    .subtasks {
        list-style: none;
        padding-left: 0;
        margin: 0;
        display: flex;
        flex-direction: column;
        gap: 6px;
        max-height: 300px;
        overflow-y: auto;
    }

    /* Ítems de tarea */
    .task-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 8px;
        padding: 6px 4px;
        border-bottom: 1px solid rgba(0,0,0,0.04);
    }

    input[type="checkbox"] {
        width: 18px;
        height: 18px;
        flex: 0 0 18px;
        margin-right: 8px;
        cursor: pointer;
    }

    /* Nombre de la tarea */
    .task-name {
        flex-grow: 1;
        cursor: pointer;
        user-select: none;
        padding-right: 8px;
        transition: all 0.2s ease;
    }

    /* Línea superior para tareas completadas */
    .task-item.completed-task .task-name {
        border-top: 3px solid #0B3C4A; /* Línea encima más visible */
        padding-top: 4px; /* Espacio entre línea y texto */
        opacity: 0.85;
    }
    /* === Igual funcionalidad que subtareas === */
    .task-name.completed {
        text-decoration: line-through; /* misma línea encima */
        opacity: 0.6; /* más tenue */
        transition: all 0.2s ease;
    }

    /* Acciones de la tarea (botones) */
    .task-actions {
        display: flex;
        gap: 6px;
        align-items: center;
    }

    /* Opcional: efecto al pasar el mouse por encima */
    .task-item:hover .task-name {
        color: #0B3C4A;
        font-weight: 600;
    }

    /* Botones de editar y eliminar */
    .edit-btn, .delete-btn {
        font-size: 14px;
        background: none;
        border: none;
        cursor: pointer;
        padding: 6px;
        border-radius: 8px;
    }

        .edit-btn:hover {
            background: rgba(0,0,0,0.04);
        }

        .delete-btn:hover {
            background: rgba(255,0,0,0.06);
        }

    .workorder {
        font-weight: 700;
    }

    /* Modal */
    .modal-backdrop {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(11,60,74,0.65);
        z-index: 1000;
    }

    .modal-content {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%,-50%);
        background: #FEFEFE;
        padding: 18px;
        border-radius: 12px;
        z-index: 1001;
        width: 90%;
        max-width: 640px;
        max-height: 80vh;
        overflow-y: auto;
        box-shadow: 0 12px 35px rgba(0,0,0,0.2);
    }

    .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 12px;
    }

    .close-btn {
        font-size: 24px;
        background: none;
        border: none;
        cursor: pointer;
        color: #0B3C4A;
    }

    .form-group {
        margin-bottom: 10px;
    }

        .form-group label {
            display: block;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 8px;
            border-radius: 8px;
            border: 1px solid #eee;
            box-sizing: border-box;
        }

    input:disabled, textarea:disabled, select:disabled {
        background: #f5f5f5;
        color: #444;
    }

    .modal-footer {
        display: flex;
        justify-content: flex-end;
        gap: 8px;
        padding-top: 8px;
        border-top: 1px solid #f0f0f0;
    }

    .action-btn {
        padding: 8px 12px;
        font-weight: 700;
        color: white;
        border: none;
        border-radius: 999px;
        cursor: pointer;
    }

        .action-btn.save {
            background: #0B3C4A;
        }

        .action-btn.cancel {
            background: #ef4444;
        }

    /* Confirm modal */
    .confirm-modal {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%,-50%);
        z-index: 1002;
        background: white;
        padding: 16px;
        border-radius: 10px;
        box-shadow: 0 8px 30px rgba(0,0,0,0.18);
        width: 90%;
        max-width: 420px;
    }

    .confirm-actions {
        display: flex;
        gap: 10px;
        justify-content: flex-end;
        margin-top: 12px;
    }

    /* Toast */
    .toast {
        position: fixed;
        right: 18px;
        bottom: 18px;
        background: linear-gradient(90deg,#0B3C4A,#1e7a3a);
        color: white;
        padding: 10px 14px;
        border-radius: 10px;
        box-shadow: 0 6px 18px rgba(0,0,0,0.25);
        z-index: 2000;
        font-weight: 700;
    }



    .btn {
        min-width: auto;
        padding: 8px 10px;
    }

    }
</style>
