@inject IJSRuntime JS

<input @ref="inputRef"
       class="date-control @CssClass"
       placeholder="dd/MM/yyyy" />

@code {
    [Parameter] public DateTime? Value { get; set; }
    [Parameter] public EventCallback<DateTime?> ValueChanged { get; set; }
    [Parameter] public string CssClass { get; set; } = "date-control";

    private ElementReference inputRef;
    private DotNetObjectReference<DatePicker>? dotNetRef;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            dotNetRef = DotNetObjectReference.Create(this);

            await JS.InvokeVoidAsync(
                "flatpickrInit",
                inputRef,
                Value,
                dotNetRef,
                true
            );
        }
    }

    [JSInvokable]
    public async Task OnDateSelected(string isoDate)
    {
        var fecha = string.IsNullOrWhiteSpace(isoDate)
            ? (DateTime?)null
            : DateTime.Parse(isoDate);

        await ValueChanged.InvokeAsync(fecha);
    }
}

<style>
    /* =================================================
           MODO OSCURO UNIFICADO: FLATPICKR & COMPONENTES
           ================================================= */

    /* 1. INPUT DEL CALENDARIO */
    [data-theme="dark"] .date-control {
        background-color: #0f172a !important;
        color: #ffffff !important;
        border: 1px solid #4b5563 !important;
        border-radius: 8px;
        padding: 8px 12px;
    }

    /* 2. CONTENEDOR PRINCIPAL DEL CALENDARIO */
    [data-theme="dark"] .flatpickr-calendar {
        background: #111827 !important; /* Fondo ultra oscuro */
        border: 1px solid #374151 !important;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.6) !important;
    }

    /* 3. CABECERA (MES Y AÑO) - Azul más oscuro y profundo */
    [data-theme="dark"] .flatpickr-months {
        background: #000000 !important; /* Azul medianoche */
        border-radius: 5px 5px 0 0;
    }

    [data-theme="dark"] .flatpickr-current-month,
    [data-theme="dark"] .flatpickr-month,
    [data-theme="dark"] .flatpickr-current-month .flatpickr-monthDropdown-months,
    [data-theme="dark"] .flatpickr-current-month input.cur-year {
        color: #ffffff !important;
        fill: #ffffff !important;
        background: transparent !important;
    }

    /* 4. DÍAS DE LA SEMANA (Elimina la franja extraña) */
    [data-theme="dark"] .flatpickr-weekdays {
        background: #000000 !important; /* Mismo color que la cabecera para unificar */
        height: 30px;
    }

    [data-theme="dark"] span.flatpickr-weekday {
        background: transparent !important;
        color: #9ca3af !important; /* Gris suave */
        font-weight: bold;
    }

    /* 5. CUERPO DE DÍAS */
    [data-theme="dark"] .flatpickr-innerContainer,
    [data-theme="dark"] .flatpickr-days,
    [data-theme="dark"] .dayContainer {
        background: #111827 !important;
    }

    [data-theme="dark"] .flatpickr-day {
        color: #cbd5e1 !important;
        border-radius: 8px;
    }

        /* Día Hoy */
        [data-theme="dark"] .flatpickr-day.today {
            border-color: #3b82f6 !important;
            color: #3b82f6 !important;
        }

        /* Día Seleccionado */
        [data-theme="dark"] .flatpickr-day.selected {
            background: #2563eb !important;
            border-color: #2563eb !important;
            color: #ffffff !important;
        }

        /* Hover sobre días */
        [data-theme="dark"] .flatpickr-day:hover {
            background: #1f2937 !important;
            color: #ffffff !important;
        }

        /* Días fuera de mes */
        [data-theme="dark"] .flatpickr-day.prevMonthDay,
        [data-theme="dark"] .flatpickr-day.nextMonthDay {
            color: #4b5563 !important;
        }

    /* 6. FLECHAS DE NAVEGACIÓN */
    [data-theme="dark"] .flatpickr-prev-month,
    [data-theme="dark"] .flatpickr-next-month {
        fill: #ffffff !important;
        color: #ffffff !important;
    }

        [data-theme="dark"] .flatpickr-prev-month:hover svg,
        [data-theme="dark"] .flatpickr-next-month:hover svg {
            fill: #3b82f6 !important;
        }

    /* 7. EXTERMINIO DE FOOTERS Y MODALES BLANCOS (De tus capturas) */
    [data-theme="dark"] .modal-footer,
    [data-theme="dark"] .modal-content {
        background-color: #111827 !important;
        border-color: #374151 !important;
    }

    [data-theme="dark"] .equipo-item,
    [data-theme="dark"] .list-group-item {
        background-color: #1f2937 !important;
        color: #f3f4f6 !important;
        border-radius: 12px !important;
    }

    /* Asegurar que el contenedor de días tenga altura automática */
    [data-theme="dark"] .flatpickr-calendar {
        height: auto !important;
        min-height: 300px; /* Altura mínima recomendada */
        display: flex;
        flex-direction: column;
    }

    [data-theme="dark"] .flatpickr-innerContainer {
        overflow: visible !important;
    }

    [data-theme="dark"] .flatpickr-days {
        width: auto !important;
        overflow: visible !important;
        display: block !important;
    }

    /* IMPORTANTE: Evitar que el modal corte el calendario */
    .modal-body, .main-form-grid {
        overflow: visible !important;
    }
</style>