@inject NavigationManager navigate


<div class="menu-container sticky-top">
    <nav class="navbar navbar-expand navbar-dark navbar-custom shadow-lg">
        <div class="container-fluid d-flex justify-content-between align-items-center">
            <a class="navbar-brand" href="#">Agenda GM 📅</a>

            <div class="d-flex align-items-center">
                <div class="navbar-nav ms-auto">
                    <button class="subnav-btn" @onclick="@dias">
                        Día
                    </button>
                    <button class="subnav-btn" @onclick="@semanas">
                        Semana
                    </button>
                    <button class="subnav-btn" @onclick="@mes">
                        Mes
                    </button>
                    <button class="subnav-btn" @onclick="@plan">
                         Servicio al cliente
                    </button>
                    <button class="subnav-btn" @onclick="@mes">
                        Autoevaluación
                    </button>
                </div>
            </div>
         
            <div class="dropdown">
                <a class="nav-link text-white dropdown-toggle" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                    celestemartinez
                </a>
                <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
                    <li><a class="dropdown-item" href="/perfil">Perfil</a></li>
                    <li><a class="dropdown-item" href="/configuracion">Configuración</a></li>
                    <li><hr class="dropdown-divider"></li>
                    <li><a class="dropdown-item" href="#">Cerrar sesión</a></li>
                </ul>
            </div>
        </div>
    </nav>
</div>


<style scoped>
    /* 1. Contenedor Fijo/Sticky */
    .menu-container {
        /* Mantiene todo fijo en la parte superior al hacer scroll */
        background-color: white;
        z-index: 1050;
    }

    /* 2. Navbar Principal */
    .navbar-custom {
        background-color: #0B3C4A; /* Azul oscuro */
    }

    .nav-link {
        color: #0B3C4A;
        font-size: 1.2rem;
        font-weight: 500;
    }

    /* 3. Contenedor de la píldora del Submenú */
    .subnav-float {
        background-color: transparent;
        padding: 4px 0; /* Espacio vertical */
    }

    /* 4. Estilo de la "Píldora Flotante" - ¡FONDO TRANSPARENTE AQUÍ! */
    .subnav-pill {
        background-color: transparent;
        padding: 4px 10px;
        display: flex;
        /* AUMENTAMOS EL ESPACIO ENTRE BOTONES */
        gap: 8px; /* Era 5px */
        /* La sombra (shadow-sm) da el efecto flotante sobre el fondo blanco del .menu-container */
    }

    /* 5. Estilos de los botones dentro de la píldora */
    .subnav-btn {
        /* Reset de estilos de Bootstrap 'btn' que podrían causar problemas */
        appearance: none;
        border: none;
        margin: 0;
        padding: 0;
        cursor: pointer;
        /* Estilos personalizados */
        background-color: transparent;
        /* AUMENTAMOS EL TAMAÑO DE LA FUENTE */
        font-size: 1.15rem; /* Era 1rem */
        font-weight: 600;
        color: #FFFF;
        transition: all 0.2s ease;
        border-radius: 18px;
        /* AUMENTAMOS EL RELLENO (PADDING) DEL BOTÓN */
        padding: 6px 16px; /* Era 4px 12px */
        line-height: 1.5;
    }

        /* Asegurar que los estados se mantengan específicos */
        .subnav-btn:hover {
            background-color: #d6e9ef; /* Un color de fondo sutil al pasar el ratón */
            color: #007BFF;
        }

        .subnav-btn:focus,
        .subnav-btn:active:focus {
            outline: none; /* Quita el contorno de enfoque por defecto si no lo quieres */
            box-shadow: 0 0 0 0.25rem rgba(11, 60, 74, 0.25); /* Sombra de enfoque personalizada */
        }


        /* Opcional: Estilo para el botón activo/seleccionado */
        .subnav-btn.active {
            background-color: #0B3C4A;
            color: white;
        }
</style>



@code {
    private void dias()
    {
        navigate.NavigateTo("/");
    }

    private void semanas()
    {
        navigate.NavigateTo("/semanal");
    }

    private void mes()
    {
        navigate.NavigateTo("/calendario");
    }
    private void plan()
    {
        navigate.NavigateTo("/plantrabajo");
    }
    /*modaal de agregar*/
    public bool ShowModal { get; set; } = false;
    public enum FormTypes { Evento, Tarea, Administrativa }
    public FormTypes FormType { get; set; } = FormTypes.Administrativa;

    public bool showAlert { get; set; } = false;
    public string alertTitle { get; set; } = "";
    public string alertMessage { get; set; } = "";
    public string alertType { get; set; } = "";

    public bool showOtherLocationInput { get; set; } = false;
    public bool showOtherTaskNameInput { get; set; } = false;

    private string newSubtask = string.Empty;
    private List<string> subtasks = new List<string>();


    public void OpenModal()
    {
        ShowModal = true;
    }

    public void CheckClose()
    {
        alertTitle = "Confirmar";
        alertMessage = "¿Seguro que quieres cerrar sin guardar?";
        alertType = "confirm";
        showAlert = true;
    }

    public void ConfirmClose()
    {
        CloseModal();
        CancelAlert();
    }

    public void CloseModal()
    {
        ShowModal = false;
    }

    public void CheckSave()
    {
        alertTitle = "Guardado Exitoso";
        alertMessage = $"El {FormType.ToString().ToLower()} se guardó exitosamente.";
        alertType = "info";
        showAlert = true;
    }

    public void ConfirmSaveAndClose()
    {
        CloseModal();
        CancelAlert();
    }

    public void CancelAlert()
    {
        showAlert = false;
    }

    public void ir()
    {
        navigate.NavigateTo("/calendar");
        CloseModal();
    }

    private void SetFormType(FormTypes type)
    {
        FormType = type;
        showOtherLocationInput = false;
        showOtherTaskNameInput = false;
        // Limpiar subtasks al cambiar de tipo para simular formulario nuevo
        if (type != FormTypes.Tarea)
        {
            subtasks.Clear();
        }
        StateHasChanged();
    }

    private void HandleLocationChange(ChangeEventArgs e)
    {
        if (e.Value != null)
        {
            showOtherLocationInput = e.Value.ToString() == "otra";
        }
    }

    private void HandleTaskNameChange(ChangeEventArgs e)
    {
        if (e.Value != null)
        {
            showOtherTaskNameInput = e.Value.ToString() == "otra";
        }
    }

    private void AddSubtask()
    {
        if (!string.IsNullOrWhiteSpace(newSubtask))
        {
            subtasks.Add(newSubtask.Trim());
            newSubtask = string.Empty;
        }
    }

    private void AddSubtaskOnEnter(KeyboardEventArgs e)
    {
        if (e.Key == "Enter")
        {
            AddSubtask();
        }
    }

    private void RemoveSubtask(string taskToRemove)
    {
        subtasks.Remove(taskToRemove);
    }
}