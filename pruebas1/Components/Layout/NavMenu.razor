@using pruebas1.Components.DTOs
@using pruebas1.Servicios

@inject NavigationManager navigate
@inject LoginService loginService
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<div class="menu-container sticky-top">
    <nav class="navbar navbar-expand navbar-dark navbar-custom shadow-lg">
        <div class="container-fluid d-flex justify-content-between align-items-center">

            <img class="navbar-brand" src="/images/logomail.png" style="width: 250px; border-radius:15px; height: auto;" alt="Logotipo" />


            <div class="d-flex align-items-center">
                <div class="navbar-nav ms-auto">
                    <button class="subnav-btn" @onclick="@dias">
                        Día
                    </button>
                    <button class="subnav-btn" @onclick="@semanas">
                        Semana
                    </button>
                    <button class="subnav-btn" @onclick="@mes">
                        Mes
                    </button>
                    <button class="subnav-btn" @onclick="@plan">
                        Servicio al cliente
                    </button>
                    <button class="subnav-btn" @onclick="@autoevaluacion">
                        Autoevaluación
                    </button>
                </div>
            </div>

            <div class="dropdown">
                <a class="nav-link user-nav dropdown-toggle"
                   href="#" id="userDropdown"
                   role="button" data-bs-toggle="dropdown" aria-expanded="false">
                    <i class="bi bi-person-circle icon-user"></i>@nombreusuario
                </a>
                <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
                    <li><a class="dropdown-item" href="/">Configuración</a></li>
                    <li><hr class="dropdown-divider"></li>
                    <li><a class="dropdown-item" style="cursor:pointer" @onclick="cerrarsesion">Cerrar sesión</a></li>
                </ul>
            </div>
        </div>
    </nav>
</div>


<style scoped>
    /* ---- ELIMINAR DESBORDES ---- */
    html, body {
        overflow-x: hidden !important;
        width: 100%;
    }

    * {
        max-width: 100%;
        box-sizing: border-box;
    }
    /* 1. Contenedor Fijo/Sticky */
    .menu-container {
        position: sticky;
        top: 0;
        z-index: 2000;
        background-color: #C6E9F0 !important; /* tu azul */
    }
    /* ---- CONTROLAR EL DESBORDAMIENTO ---- */
    .container-fluid {
        flex-wrap: wrap !important;
    }
    /* ---- LOGO ---- */
    .navbar-brand {
        max-width: 250px;
        height: auto;
    }

    .icon-user {
        font-size: 1.4rem;
        color: black;
    }

    .navbar .dropdown .nav-link,
    .navbar .dropdown .user-nav {
        color: black !important;
    }

    .navbar .dropdown .user-nav {
        color: black !important; /* aquí cambias el color */
    }


    /* 3. Contenedor de la píldora del Submenú */
    .subnav-float {
        background-color: transparent;
        padding: 4px 0; /* Espacio vertical */
    }

    /* 4. Estilo de la "Píldora Flotante" - ¡FONDO TRANSPARENTE AQUÍ! */
    .subnav-pill {
        background-color: transparent;
        padding: 4px 10px;
        display: flex;
        /* AUMENTAMOS EL ESPACIO ENTRE BOTONES */
        gap: 8px; /* Era 5px */
        /* La sombra (shadow-sm) da el efecto flotante sobre el fondo blanco del .menu-container */
    }

    /* 5. Estilos de los botones dentro de la píldora */
    .subnav-btn {
        /* Reset de estilos de Bootstrap 'btn' que podrían causar problemas */
        appearance: none;
        border: none;
        margin: 0;
        padding: 0;
        cursor: pointer;
        /* Estilos personalizados */
        background-color: transparent;
        /* AUMENTAMOS EL TAMAÑO DE LA FUENTE */
        font-size: 1.39rem; /* Era 1rem */
        font-weight: 600;
        color: #000;
        transition: all 0.2s ease;
        border-radius: 18px;
        /* AUMENTAMOS EL RELLENO (PADDING) DEL BOTÓN */
        padding: 10px 20px; /* Era 4px 12px */
        line-height: 1.5;
    }

        /* Asegurar que los estados se mantengan específicos */
        .subnav-btn:hover {
            background-color: white; /* Un color de fondo sutil al pasar el ratón */
            color: #007BFF;
        }

        .subnav-btn:focus,
        .subnav-btn:active:focus {
            outline: none; /* Quita el contorno de enfoque por defecto si no lo quieres */
        }


        /* Opcional: Estilo para el botón activo/seleccionado */
        .subnav-btn.active {
            background-color: #0B3C4A;
            color: black;
        }

    @@media (max-width: 768px) {
        .navbar-brand {
            max-width: 150px;
        }
    }

    /* ---- SUBMENÚ RESPONSIVO ---- */
    .navbar-nav {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
        width: 100%;
        justify-content: center;
    }

    .subnav-btn {
        padding: 10px 15px;
        font-size: 1.30rem;
        font-weight: 600;
        background: transparent;
        border: none;
        border-radius: 12px;
        transition: 0.2s;
        white-space: nowrap;
        max-width: 100%;
    }

    /* MÓVILES */
    @@media (max-width: 480px) {
        .subnav-btn {
            padding: 8px 10px;
            font-size: 0.85rem;
        }
    }
</style>



@code {
    private void dias()
    {
        navigate.NavigateTo("/dia2");
    }

    private void semanas()
    {
        navigate.NavigateTo("/semanal");
    }

    private void mes()
    {
        navigate.NavigateTo("/calendario");
    }
    private void plan()
    {
        navigate.NavigateTo("/plantrabajo");
    }
    private void autoevaluacion()
    {
        navigate.NavigateTo("/autoevaluacion");
    }
    public string nombreusuario { get; set; } = "";

    protected override async Task OnInitializedAsync()
    {
        UsuarioLoginDTO obj = loginService.obtenerUsuarioLogueado();
        nombreusuario = obj.NombreUsuario;
    }

    public async Task cerrarsesion()
    {
        loginService.cerrarSesion();
        navigate.NavigateTo("/");
    }
    /*modaal de agregar*/
    public bool ShowModal { get; set; } = false;
    public enum FormTypes { Evento, Tarea, Administrativa }
    public FormTypes FormType { get; set; } = FormTypes.Administrativa;

    public bool showAlert { get; set; } = false;
    public string alertTitle { get; set; } = "";
    public string alertMessage { get; set; } = "";
    public string alertType { get; set; } = "";

    public bool showOtherLocationInput { get; set; } = false;
    public bool showOtherTaskNameInput { get; set; } = false;

    private string newSubtask = string.Empty;
    private List<string> subtasks = new List<string>();


    public void OpenModal()
    {
        ShowModal = true;
    }

    public void CheckClose()
    {
        alertTitle = "Confirmar";
        alertMessage = "¿Seguro que quieres cerrar sin guardar?";
        alertType = "confirm";
        showAlert = true;
    }

    public void ConfirmClose()
    {
        CloseModal();
        CancelAlert();
    }

    public void CloseModal()
    {
        ShowModal = false;
    }

    public void CheckSave()
    {
        alertTitle = "Guardado Exitoso";
        alertMessage = $"El {FormType.ToString().ToLower()} se guardó exitosamente.";
        alertType = "info";
        showAlert = true;
    }

    public void ConfirmSaveAndClose()
    {
        CloseModal();
        CancelAlert();
    }

    public void CancelAlert()
    {
        showAlert = false;
    }

    public void ir()
    {
        navigate.NavigateTo("/calendar");
        CloseModal();
    }

    private void SetFormType(FormTypes type)
    {
        FormType = type;
        showOtherLocationInput = false;
        showOtherTaskNameInput = false;
        // Limpiar subtasks al cambiar de tipo para simular formulario nuevo
        if (type != FormTypes.Tarea)
        {
            subtasks.Clear();
        }
        StateHasChanged();
    }

    private void HandleLocationChange(ChangeEventArgs e)
    {
        if (e.Value != null)
        {
            showOtherLocationInput = e.Value.ToString() == "otra";
        }
    }

    private void HandleTaskNameChange(ChangeEventArgs e)
    {
        if (e.Value != null)
        {
            showOtherTaskNameInput = e.Value.ToString() == "otra";
        }
    }

    private void AddSubtask()
    {
        if (!string.IsNullOrWhiteSpace(newSubtask))
        {
            subtasks.Add(newSubtask.Trim());
            newSubtask = string.Empty;
        }
    }

    private void AddSubtaskOnEnter(KeyboardEventArgs e)
    {
        if (e.Key == "Enter")
        {
            AddSubtask();
        }
    }

    private void RemoveSubtask(string taskToRemove)
    {
        subtasks.Remove(taskToRemove);
    }
}